(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,85473,(e,t,r)=>{t.exports=(function t(r,n,i){function o(a,s){if(!n[a]){if(!r[a]){var h=e.t;return!s&&h?h(a,!0):l(a,!0)}var d=n[a]={exports:{}};r[a][0].call(d.exports,function(e){return o(r[a][1][e]||e)},d,d.exports,t,r,n,i)}return n[a].exports}for(var l=e.t,a=0;a<i.length;a++)o(i[a]);return o})({1:[function(e,t,r){t.exports={graphlib:e("@dagrejs/graphlib"),layout:e("./lib/layout"),debug:e("./lib/debug"),util:{time:e("./lib/util").time,notime:e("./lib/util").notime},version:e("./lib/version")}},{"./lib/debug":6,"./lib/layout":8,"./lib/util":27,"./lib/version":28,"@dagrejs/graphlib":29}],2:[function(e,t,r){"use strict";let n=e("./greedy-fas"),i=e("./util").uniqueId;t.exports={run:function(e){var t,r;let o,l,a;("greedy"===e.graph().acyclicer?n(e,(t=e,e=>t.edge(e).weight)):(o=[],l={},a={},(r=e).nodes().forEach(function e(t){Object.hasOwn(a,t)||(a[t]=!0,l[t]=!0,r.outEdges(t).forEach(t=>{Object.hasOwn(l,t.w)?o.push(t):e(t.w)}),delete l[t])}),o)).forEach(t=>{let r=e.edge(t);e.removeEdge(t),r.forwardName=t.name,r.reversed=!0,e.setEdge(t.w,t.v,r,i("rev"))})},undo:function(e){e.edges().forEach(t=>{let r=e.edge(t);if(r.reversed){e.removeEdge(t);let n=r.forwardName;delete r.reversed,delete r.forwardName,e.setEdge(t.w,t.v,r,n)}})}}},{"./greedy-fas":7,"./util":27}],3:[function(e,t,r){let n=e("./util");function i(e,t,r,i,o,l){let a=o[t][l-1],s=n.addDummyNode(e,"border",{width:0,height:0,rank:l,borderType:t},r);o[t][l]=s,e.setParent(s,i),a&&e.setEdge(a,s,{weight:1})}t.exports=function(e){e.children().forEach(function t(r){let n=e.children(r),o=e.node(r);if(n.length&&n.forEach(t),Object.hasOwn(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(let t=o.minRank,n=o.maxRank+1;t<n;++t)i(e,"borderLeft","_bl",r,o,t),i(e,"borderRight","_br",r,o,t)}})}},{"./util":27}],4:[function(e,t,r){"use strict";function n(e){e.nodes().forEach(t=>i(e.node(t))),e.edges().forEach(t=>i(e.edge(t)))}function i(e){let t=e.width;e.width=e.height,e.height=t}function o(e){e.y=-e.y}function l(e){let t=e.x;e.x=e.y,e.y=t}t.exports={adjust:function(e){let t=e.graph().rankdir.toLowerCase();("lr"===t||"rl"===t)&&n(e)},undo:function(e){var t,r;let i=e.graph().rankdir.toLowerCase();("bt"===i||"rl"===i)&&((t=e).nodes().forEach(e=>o(t.node(e))),t.edges().forEach(e=>{let r=t.edge(e);r.points.forEach(o),Object.hasOwn(r,"y")&&o(r)})),("lr"===i||"rl"===i)&&((r=e).nodes().forEach(e=>l(r.node(e))),r.edges().forEach(e=>{let t=r.edge(e);t.points.forEach(l),Object.hasOwn(t,"x")&&l(t)}),n(e))}}},{}],5:[function(e,t,r){function n(e){e._prev._next=e._next,e._next._prev=e._prev,delete e._next,delete e._prev}function i(e,t){if("_next"!==e&&"_prev"!==e)return t}t.exports=class{constructor(){let e={};e._next=e._prev=e,this._sentinel=e}dequeue(){let e=this._sentinel,t=e._prev;if(t!==e)return n(t),t}enqueue(e){let t=this._sentinel;e._prev&&e._next&&n(e),e._next=t._next,t._next._prev=e,t._next=e,e._prev=t}toString(){let e=[],t=this._sentinel,r=t._prev;for(;r!==t;)e.push(JSON.stringify(r,i)),r=r._prev;return"["+e.join(", ")+"]"}}},{}],6:[function(e,t,r){let n=e("./util"),i=e("@dagrejs/graphlib").Graph;t.exports={debugOrdering:function(e){let t=n.buildLayerMatrix(e),r=new i({compound:!0,multigraph:!0}).setGraph({});return e.nodes().forEach(t=>{r.setNode(t,{label:t}),r.setParent(t,"layer"+e.node(t).rank)}),e.edges().forEach(e=>r.setEdge(e.v,e.w,{},e.name)),t.forEach((e,t)=>{r.setNode("layer"+t,{rank:"same"}),e.reduce((e,t)=>(r.setEdge(e,t,{style:"invis"}),t))}),r}}},{"./util":27,"@dagrejs/graphlib":29}],7:[function(e,t,r){let n=e("@dagrejs/graphlib").Graph,i=e("./data/list");t.exports=function(e,t){var r,s;let h,d,f,c,u;if(1>=e.nodeCount())return[];let g=(r=e,s=t||o,h=new n,d=0,f=0,r.nodes().forEach(e=>{h.setNode(e,{v:e,in:0,out:0})}),r.edges().forEach(e=>{let t=h.edge(e.v,e.w)||0,r=s(e);h.setEdge(e.v,e.w,t+r),f=Math.max(f,h.node(e.v).out+=r),d=Math.max(d,h.node(e.w).in+=r)}),c=(function(e){let t=[];for(let r=0;r<e;r++)t.push(r);return t})(f+d+3).map(()=>new i),u=d+1,h.nodes().forEach(e=>{a(c,u,h.node(e))}),{graph:h,buckets:c,zeroIdx:u});return(function(e,t,r){let n,i=[],o=t[t.length-1],a=t[0];for(;e.nodeCount();){for(;n=a.dequeue();)l(e,t,r,n);for(;n=o.dequeue();)l(e,t,r,n);if(e.nodeCount()){for(let o=t.length-2;o>0;--o)if(n=t[o].dequeue()){i=i.concat(l(e,t,r,n,!0));break}}}return i})(g.graph,g.buckets,g.zeroIdx).flatMap(t=>e.outEdges(t.v,t.w))};let o=()=>1;function l(e,t,r,n,i){let o=i?[]:void 0;return e.inEdges(n.v).forEach(n=>{let l=e.edge(n),s=e.node(n.v);i&&o.push({v:n.v,w:n.w}),s.out-=l,a(t,r,s)}),e.outEdges(n.v).forEach(n=>{let i=e.edge(n),o=n.w,l=e.node(o);l.in-=i,a(t,r,l)}),e.removeNode(n.v),o}function a(e,t,r){r.out?r.in?e[r.out-r.in+t].enqueue(r):e[e.length-1].enqueue(r):e[0].enqueue(r)}},{"./data/list":5,"@dagrejs/graphlib":29}],8:[function(e,t,r){"use strict";let n=e("./acyclic"),i=e("./normalize"),o=e("./rank"),l=e("./util").normalizeRanks,a=e("./parent-dummy-chains"),s=e("./util").removeEmptyRanks,h=e("./nesting-graph"),d=e("./add-border-segments"),f=e("./coordinate-system"),c=e("./order"),u=e("./position"),g=e("./util"),p=e("@dagrejs/graphlib").Graph;t.exports=function(e,t){let r=t&&t.debugTiming?g.time:g.notime;r("layout",()=>{let E=r("  buildLayoutGraph",()=>{var t;let r,n;return t=e,r=new p({multigraph:!0,compound:!0}),n=_(t.graph()),r.setGraph(Object.assign({},y,M(n,m),g.pick(n,x))),t.nodes().forEach(e=>{let n=M(_(t.node(e)),w);Object.keys(b).forEach(e=>{void 0===n[e]&&(n[e]=b[e])}),r.setNode(e,n),r.setParent(e,t.parent(e))}),t.edges().forEach(e=>{let n=_(t.edge(e));r.setEdge(e,Object.assign({},$,M(n,v),g.pick(n,k)))}),r});r("  runLayout",()=>{var e,p,m;return e=E,p=r,m=t,void(p("    makeSpaceForEdgeLabels",()=>{var t;let r;return r=(t=e).graph(),void(r.ranksep/=2,t.edges().forEach(e=>{let n=t.edge(e);n.minlen*=2,"c"!==n.labelpos.toLowerCase()&&("TB"===r.rankdir||"BT"===r.rankdir?n.width+=n.labeloffset:n.height+=n.labeloffset)}))}),p("    removeSelfEdges",()=>{var t;(t=e).edges().forEach(e=>{if(e.v===e.w){var r=t.node(e.v);r.selfEdges||(r.selfEdges=[]),r.selfEdges.push({e:e,label:t.edge(e)}),t.removeEdge(e)}})}),p("    acyclic",()=>n.run(e)),p("    nestingGraph.run",()=>h.run(e)),p("    rank",()=>o(g.asNonCompoundGraph(e))),p("    injectEdgeLabelProxies",()=>{var t;(t=e).edges().forEach(e=>{let r=t.edge(e);if(r.width&&r.height){let r=t.node(e.v),n={rank:(t.node(e.w).rank-r.rank)/2+r.rank,e:e};g.addDummyNode(t,"edge-proxy",n,"_ep")}})}),p("    removeEmptyRanks",()=>s(e)),p("    nestingGraph.cleanup",()=>h.cleanup(e)),p("    normalizeRanks",()=>l(e)),p("    assignRankMinMax",()=>{var t;let r;return r=0,void((t=e).nodes().forEach(e=>{let n=t.node(e);n.borderTop&&(n.minRank=t.node(n.borderTop).rank,n.maxRank=t.node(n.borderBottom).rank,r=Math.max(r,n.maxRank))}),t.graph().maxRank=r)}),p("    removeEdgeLabelProxies",()=>{var t;(t=e).nodes().forEach(e=>{let r=t.node(e);"edge-proxy"===r.dummy&&(t.edge(r.e).labelRank=r.rank,t.removeNode(e))})}),p("    normalize.run",()=>i.run(e)),p("    parentDummyChains",()=>a(e)),p("    addBorderSegments",()=>d(e)),p("    order",()=>c(e,m)),p("    insertSelfEdges",()=>{var t;return t=e,void g.buildLayerMatrix(t).forEach(e=>{var r=0;e.forEach((e,n)=>{var i=t.node(e);i.order=n+r,(i.selfEdges||[]).forEach(e=>{g.addDummyNode(t,"selfedge",{width:e.label.width,height:e.label.height,rank:i.rank,order:n+ ++r,e:e.e,label:e.label},"_se")}),delete i.selfEdges})})}),p("    adjustCoordinateSystem",()=>f.adjust(e)),p("    position",()=>u(e)),p("    positionSelfEdges",()=>{var t;(t=e).nodes().forEach(e=>{var r=t.node(e);if("selfedge"===r.dummy){var n=t.node(r.e.v),i=n.x+n.width/2,o=n.y,l=r.x-i,a=n.height/2;t.setEdge(r.e,r.label),t.removeNode(e),r.label.points=[{x:i+2*l/3,y:o-a},{x:i+5*l/6,y:o-a},{x:i+l,y:o},{x:i+5*l/6,y:o+a},{x:i+2*l/3,y:o+a}],r.label.x=r.x,r.label.y=r.y}})}),p("    removeBorderNodes",()=>{var t;(t=e).nodes().forEach(e=>{if(t.children(e).length){let r=t.node(e),n=t.node(r.borderTop),i=t.node(r.borderBottom),o=t.node(r.borderLeft[r.borderLeft.length-1]),l=t.node(r.borderRight[r.borderRight.length-1]);r.width=Math.abs(l.x-o.x),r.height=Math.abs(i.y-n.y),r.x=o.x+r.width/2,r.y=n.y+r.height/2}}),t.nodes().forEach(e=>{"border"===t.node(e).dummy&&t.removeNode(e)})}),p("    normalize.undo",()=>i.undo(e)),p("    fixupEdgeLabelCoords",()=>{var t;(t=e).edges().forEach(e=>{let r=t.edge(e);if(Object.hasOwn(r,"x"))switch(("l"===r.labelpos||"r"===r.labelpos)&&(r.width-=r.labeloffset),r.labelpos){case"l":r.x-=r.width/2+r.labeloffset;break;case"r":r.x+=r.width/2+r.labeloffset}})}),p("    undoCoordinateSystem",()=>f.undo(e)),p("    translateGraph",()=>(function(e){let t=1/0,r=0,n=1/0,i=0,o=e.graph(),l=o.marginx||0,a=o.marginy||0;function s(e){let o=e.x,l=e.y,a=e.width,s=e.height;t=Math.min(t,o-a/2),r=Math.max(r,o+a/2),n=Math.min(n,l-s/2),i=Math.max(i,l+s/2)}e.nodes().forEach(t=>s(e.node(t))),e.edges().forEach(t=>{let r=e.edge(t);Object.hasOwn(r,"x")&&s(r)}),t-=l,n-=a,e.nodes().forEach(r=>{let i=e.node(r);i.x-=t,i.y-=n}),e.edges().forEach(r=>{let i=e.edge(r);i.points.forEach(e=>{e.x-=t,e.y-=n}),Object.hasOwn(i,"x")&&(i.x-=t),Object.hasOwn(i,"y")&&(i.y-=n)}),o.width=r-t+l,o.height=i-n+a})(e)),p("    assignNodeIntersects",()=>{var t;(t=e).edges().forEach(e=>{let r,n,i=t.edge(e),o=t.node(e.v),l=t.node(e.w);i.points?(r=i.points[0],n=i.points[i.points.length-1]):(i.points=[],r=l,n=o),i.points.unshift(g.intersectRect(o,r)),i.points.push(g.intersectRect(l,n))})}),p("    reversePoints",()=>{var t;(t=e).edges().forEach(e=>{let r=t.edge(e);r.reversed&&r.points.reverse()})}),p("    acyclic.undo",()=>n.undo(e)))}),r("  updateInputGraph",()=>{var t,r;return t=e,r=E,void(t.nodes().forEach(e=>{let n=t.node(e),i=r.node(e);n&&(n.x=i.x,n.y=i.y,n.rank=i.rank,r.children(e).length&&(n.width=i.width,n.height=i.height))}),t.edges().forEach(e=>{let n=t.edge(e),i=r.edge(e);n.points=i.points,Object.hasOwn(i,"x")&&(n.x=i.x,n.y=i.y)}),t.graph().width=r.graph().width,t.graph().height=r.graph().height)})})};let m=["nodesep","edgesep","ranksep","marginx","marginy"],y={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},x=["acyclicer","ranker","rankdir","align"],w=["width","height","rank"],b={width:0,height:0},v=["minlen","weight","width","height","labeloffset"],$={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},k=["labelpos"];function M(e,t){return g.mapValues(g.pick(e,t),Number)}function _(e){var t={};return e&&Object.entries(e).forEach(([e,r])=>{"string"==typeof e&&(e=e.toLowerCase()),t[e]=r}),t}},{"./acyclic":2,"./add-border-segments":3,"./coordinate-system":4,"./nesting-graph":9,"./normalize":10,"./order":15,"./parent-dummy-chains":20,"./position":22,"./rank":24,"./util":27,"@dagrejs/graphlib":29}],9:[function(e,t,r){let n=e("./util");t.exports={run:function(e){var t,r,i;let o=n.addDummyNode(e,"root",{},"_root"),l=(r={},(t=e).children().forEach(e=>(function e(n,i){var o=t.children(n);o&&o.length&&o.forEach(t=>e(t,i+1)),r[n]=i})(e,1)),r),a=Object.values(l),s=n.applyWithChunking(Math.max,a)-1,h=2*s+1;e.graph().nestingRoot=o,e.edges().forEach(t=>e.edge(t).minlen*=h);let d=(i=e).edges().reduce((e,t)=>e+i.edge(t).weight,0)+1;e.children().forEach(t=>(function e(t,r,i,o,l,a,s){let h=t.children(s);if(!h.length){s!==r&&t.setEdge(r,s,{weight:0,minlen:i});return}let d=n.addBorderNode(t,"_bt"),f=n.addBorderNode(t,"_bb"),c=t.node(s);t.setParent(d,s),c.borderTop=d,t.setParent(f,s),c.borderBottom=f,h.forEach(n=>{e(t,r,i,o,l,a,n);let h=t.node(n),c=h.borderTop?h.borderTop:n,u=h.borderBottom?h.borderBottom:n,g=h.borderTop?o:2*o,p=c!==u?1:l-a[s]+1;t.setEdge(d,c,{weight:g,minlen:p,nestingEdge:!0}),t.setEdge(u,f,{weight:g,minlen:p,nestingEdge:!0})}),t.parent(s)||t.setEdge(r,d,{weight:0,minlen:l+a[s]})})(e,o,h,d,s,l,t)),e.graph().nodeRankFactor=h},cleanup:function(e){var t=e.graph();e.removeNode(t.nestingRoot),delete t.nestingRoot,e.edges().forEach(t=>{e.edge(t).nestingEdge&&e.removeEdge(t)})}}},{"./util":27}],10:[function(e,t,r){"use strict";let n=e("./util");t.exports={run:function(e){e.graph().dummyChains=[],e.edges().forEach(t=>(function(e,t){let r,i,o,l=t.v,a=e.node(l).rank,s=t.w,h=e.node(s).rank,d=t.name,f=e.edge(t),c=f.labelRank;if(h!==a+1){for(e.removeEdge(t),o=0,++a;a<h;++o,++a)f.points=[],i={width:0,height:0,edgeLabel:f,edgeObj:t,rank:a},r=n.addDummyNode(e,"edge",i,"_d"),a===c&&(i.width=f.width,i.height=f.height,i.dummy="edge-label",i.labelpos=f.labelpos),e.setEdge(l,r,{weight:f.weight},d),0===o&&e.graph().dummyChains.push(r),l=r;e.setEdge(l,s,{weight:f.weight},d)}})(e,t))},undo:function(e){e.graph().dummyChains.forEach(t=>{let r,n=e.node(t),i=n.edgeLabel;for(e.setEdge(n.edgeObj,i);n.dummy;)r=e.successors(t)[0],e.removeNode(t),i.points.push({x:n.x,y:n.y}),"edge-label"===n.dummy&&(i.x=n.x,i.y=n.y,i.width=n.width,i.height=n.height),t=r,n=e.node(t)})}}},{"./util":27}],11:[function(e,t,r){t.exports=function(e,t,r){let n={},i;r.forEach(r=>{let o=e.parent(r),l,a;for(;o;){if((l=e.parent(o))?(a=n[l],n[l]=o):(a=i,i=o),a&&a!==o)return void t.setEdge(a,o);o=l}})}},{}],12:[function(e,t,r){t.exports=function(e,t=[]){return t.map(t=>{let r=e.inEdges(t);if(!r.length)return{v:t};{let n=r.reduce((t,r)=>{let n=e.edge(r),i=e.node(r.v);return{sum:t.sum+n.weight*i.order,weight:t.weight+n.weight}},{sum:0,weight:0});return{v:t,barycenter:n.sum/n.weight,weight:n.weight}}})}},{}],13:[function(e,t,r){let n=e("@dagrejs/graphlib").Graph,i=e("../util");t.exports=function(e,t,r,o){o||(o=e.nodes());let l=function(e){for(var t;e.hasNode(t=i.uniqueId("_root")););return t}(e),a=new n({compound:!0}).setGraph({root:l}).setDefaultNodeLabel(t=>e.node(t));return o.forEach(n=>{let i=e.node(n),o=e.parent(n);(i.rank===t||i.minRank<=t&&t<=i.maxRank)&&(a.setNode(n),a.setParent(n,o||l),e[r](n).forEach(t=>{let r=t.v===n?t.w:t.v,i=a.edge(r,n),o=void 0!==i?i.weight:0;a.setEdge(r,n,{weight:e.edge(t).weight+o})}),Object.hasOwn(i,"minRank")&&a.setNode(n,{borderLeft:i.borderLeft[t],borderRight:i.borderRight[t]}))}),a}},{"../util":27,"@dagrejs/graphlib":29}],14:[function(e,t,r){"use strict";let n=e("../util").zipObject;t.exports=function(e,t){let r=0;for(let i=1;i<t.length;++i)r+=function(e,t,r){let i=n(r,r.map((e,t)=>t)),o=t.flatMap(t=>e.outEdges(t).map(t=>({pos:i[t.w],weight:e.edge(t).weight})).sort((e,t)=>e.pos-t.pos)),l=1;for(;l<r.length;)l<<=1;let a=2*l-1;l-=1;let s=Array(a).fill(0),h=0;return o.forEach(e=>{let t=e.pos+l;s[t]+=e.weight;let r=0;for(;t>0;)t%2&&(r+=s[t+1]),t=t-1>>1,s[t]+=e.weight;h+=e.weight*r}),h}(e,t[i-1],t[i]);return r}},{"../util":27}],15:[function(e,t,r){"use strict";let n=e("./init-order"),i=e("./cross-count"),o=e("./sort-subgraph"),l=e("./build-layer-graph"),a=e("./add-subgraph-constraints"),s=e("@dagrejs/graphlib").Graph,h=e("../util");function d(e,t,r){let n=new Map,i=(e,t)=>{n.has(e)||n.set(e,[]),n.get(e).push(t)};for(let t of e.nodes()){let r=e.node(t);if("number"==typeof r.rank&&i(r.rank,t),"number"==typeof r.minRank&&"number"==typeof r.maxRank)for(let e=r.minRank;e<=r.maxRank;e++)e!==r.rank&&i(e,t)}return t.map(function(t){return l(e,t,r,n.get(t)||[])})}function f(e,t){Object.values(t).forEach(t=>t.forEach((t,r)=>e.node(t).order=r))}t.exports=function e(t,r){if(r&&"function"==typeof r.customOrder)return void r.customOrder(t,e);let l=h.maxRank(t),c=d(t,h.range(1,l+1),"inEdges"),u=d(t,h.range(l-1,-1,-1),"outEdges"),g=n(t);if(f(t,g),r&&r.disableOptimalOrderHeuristic)return;let p=1/0,m;for(let e=0,r=0;r<4;++e,++r){(function(e,t){let r=new s;e.forEach(function(e){let n=e.graph().root,i=o(e,n,r,t);i.vs.forEach((t,r)=>e.node(t).order=r),a(e,r,i.vs)})})(e%2?c:u,e%4>=2),g=h.buildLayerMatrix(t);let n=i(t,g);n<p&&(r=0,m=Object.assign({},g),p=n)}f(t,m)}},{"../util":27,"./add-subgraph-constraints":11,"./build-layer-graph":13,"./cross-count":14,"./init-order":16,"./sort-subgraph":18,"@dagrejs/graphlib":29}],16:[function(e,t,r){"use strict";let n=e("../util");t.exports=function(e){let t={},r=e.nodes().filter(t=>!e.children(t).length),i=r.map(t=>e.node(t).rank),o=n.applyWithChunking(Math.max,i),l=n.range(o+1).map(()=>[]);return r.sort((t,r)=>e.node(t).rank-e.node(r).rank).forEach(function r(n){t[n]||(t[n]=!0,l[e.node(n).rank].push(n),e.successors(n).forEach(r))}),l}},{"../util":27}],17:[function(e,t,r){"use strict";let n=e("../util");t.exports=function(e,t){let r={};return e.forEach((e,t)=>{let n=r[e.v]={indegree:0,in:[],out:[],vs:[e.v],i:t};void 0!==e.barycenter&&(n.barycenter=e.barycenter,n.weight=e.weight)}),t.edges().forEach(e=>{let t=r[e.v],n=r[e.w];void 0!==t&&void 0!==n&&(n.indegree++,t.out.push(r[e.w]))}),function(e){let t=[];for(;e.length;){let r=e.pop();t.push(r),r.in.reverse().forEach(function(e){return t=>{!t.merged&&(void 0===t.barycenter||void 0===e.barycenter||t.barycenter>=e.barycenter)&&function(e,t){let r=0,n=0;e.weight&&(r+=e.barycenter*e.weight,n+=e.weight),t.weight&&(r+=t.barycenter*t.weight,n+=t.weight),e.vs=t.vs.concat(e.vs),e.barycenter=r/n,e.weight=n,e.i=Math.min(t.i,e.i),t.merged=!0}(e,t)}}(r)),r.out.forEach(function(t){return r=>{r.in.push(t),0==--r.indegree&&e.push(r)}}(r))}return t.filter(e=>!e.merged).map(e=>n.pick(e,["vs","i","barycenter","weight"]))}(Object.values(r).filter(e=>!e.indegree))}},{"../util":27}],18:[function(e,t,r){let n=e("./barycenter"),i=e("./resolve-conflicts"),o=e("./sort");t.exports=function e(t,r,l,a){var s,h;let d=t.children(r),f=t.node(r),c=f?f.borderLeft:void 0,u=f?f.borderRight:void 0,g={};c&&(d=d.filter(e=>e!==c&&e!==u));let p=n(t,d);p.forEach(r=>{if(t.children(r.v).length){var n,i;let o=e(t,r.v,l,a);g[r.v]=o,Object.hasOwn(o,"barycenter")&&(n=r,i=o,void 0!==n.barycenter?(n.barycenter=(n.barycenter*n.weight+i.barycenter*i.weight)/(n.weight+i.weight),n.weight+=i.weight):(n.barycenter=i.barycenter,n.weight=i.weight))}});let m=i(p,l);s=m,h=g,s.forEach(e=>{e.vs=e.vs.flatMap(e=>h[e]?h[e].vs:e)});let y=o(m,a);if(c&&(y.vs=[c,y.vs,u].flat(!0),t.predecessors(c).length)){let e=t.node(t.predecessors(c)[0]),r=t.node(t.predecessors(u)[0]);Object.hasOwn(y,"barycenter")||(y.barycenter=0,y.weight=0),y.barycenter=(y.barycenter*y.weight+e.order+r.order)/(y.weight+2),y.weight+=2}return y}},{"./barycenter":12,"./resolve-conflicts":17,"./sort":19}],19:[function(e,t,r){let n=e("../util");function i(e,t,r){let n;for(;t.length&&(n=t[t.length-1]).i<=r;)t.pop(),e.push(n.vs),r++;return r}t.exports=function(e,t){var r;let o=n.partition(e,e=>Object.hasOwn(e,"barycenter")),l=o.lhs,a=o.rhs.sort((e,t)=>t.i-e.i),s=[],h=0,d=0,f=0;l.sort((r=!!t,(e,t)=>e.barycenter<t.barycenter?-1:e.barycenter>t.barycenter?1:r?t.i-e.i:e.i-t.i)),f=i(s,a,f),l.forEach(e=>{f+=e.vs.length,s.push(e.vs),h+=e.barycenter*e.weight,d+=e.weight,f=i(s,a,f)});let c={vs:s.flat(!0)};return d&&(c.barycenter=h/d,c.weight=d),c}},{"../util":27}],20:[function(e,t,r){t.exports=function(e){var t;let r,n,i=(r={},n=0,(t=e).children().forEach(function e(i){let o=n;t.children(i).forEach(e),r[i]={low:o,lim:n++}}),r);e.graph().dummyChains.forEach(t=>{let r=e.node(t),n=r.edgeObj,o=function(e,t,r,n){let i,o,l=[],a=[],s=Math.min(t[r].low,t[n].low),h=Math.max(t[r].lim,t[n].lim);i=r;do l.push(i=e.parent(i));while(i&&(t[i].low>s||h>t[i].lim))for(o=i,i=n;(i=e.parent(i))!==o;)a.push(i);return{path:l.concat(a.reverse()),lca:o}}(e,i,n.v,n.w),l=o.path,a=o.lca,s=0,h=l[0],d=!0;for(;t!==n.w;){if(r=e.node(t),d){for(;(h=l[s])!==a&&e.node(h).maxRank<r.rank;)s++;h===a&&(d=!1)}if(!d){for(;s<l.length-1&&e.node(h=l[s+1]).minRank<=r.rank;)s++;h=l[s]}e.setParent(t,h),t=e.successors(t)[0]}})}},{}],21:[function(e,t,r){"use strict";let n=e("@dagrejs/graphlib").Graph,i=e("../util");function o(e,t){let r={};return t.length&&t.reduce(function(t,n){let i=0,o=0,l=t.length,s=n[n.length-1];return n.forEach((t,h)=>{let d=function(e,t){if(e.node(t).dummy)return e.predecessors(t).find(t=>e.node(t).dummy)}(e,t),f=d?e.node(d).order:l;(d||t===s)&&(n.slice(o,h+1).forEach(t=>{e.predecessors(t).forEach(n=>{let o=e.node(n),l=o.order;(l<i||f<l)&&!(o.dummy&&e.node(t).dummy)&&a(r,n,t)})}),o=h+1,i=f)}),n}),r}function l(e,t){let r={};function n(t,n,o,l,s){let h;i.range(n,o).forEach(n=>{h=t[n],e.node(h).dummy&&e.predecessors(h).forEach(t=>{let n=e.node(t);n.dummy&&(n.order<l||n.order>s)&&a(r,t,h)})})}return t.length&&t.reduce(function(t,r){let i=-1,o,l=0;return r.forEach((a,s)=>{if("border"===e.node(a).dummy){let t=e.predecessors(a);t.length&&(o=e.node(t[0]).order,n(r,l,s,i,o),l=s,i=o)}n(r,l,r.length,o,t.length)}),r}),r}function a(e,t,r){if(t>r){let e=t;t=r,r=e}let n=e[t];n||(e[t]=n={}),n[r]=!0}function s(e,t,r){if(t>r){let e=t;t=r,r=e}return!!e[t]&&Object.hasOwn(e[t],r)}function h(e,t,r,n){let i={},o={},l={};return t.forEach(e=>{e.forEach((e,t)=>{i[e]=e,o[e]=e,l[e]=t})}),t.forEach(e=>{let t=-1;e.forEach(e=>{let a=n(e);if(a.length){let n=((a=a.sort((e,t)=>l[e]-l[t])).length-1)/2;for(let h=Math.floor(n),d=Math.ceil(n);h<=d;++h){let n=a[h];o[e]===e&&t<l[n]&&!s(r,e,n)&&(o[n]=e,o[e]=i[e]=i[n],t=l[n])}}})}),{root:i,align:o}}function d(e,t,r,i,o){var l,a,s,h,d,f,c;let u,g,p,m={},y=(l=e,a=t,s=r,h=o,u=new n,p=(d=(g=l.graph()).nodesep,f=g.edgesep,c=h,(e,t,r)=>{let n,i,o=e.node(t),l=e.node(r);if(n=0+o.width/2,Object.hasOwn(o,"labelpos"))switch(o.labelpos.toLowerCase()){case"l":i=-o.width/2;break;case"r":i=o.width/2}if(i&&(n+=c?i:-i),i=0,n+=(o.dummy?f:d)/2,n+=(l.dummy?f:d)/2,n+=l.width/2,Object.hasOwn(l,"labelpos"))switch(l.labelpos.toLowerCase()){case"l":i=l.width/2;break;case"r":i=-l.width/2}return i&&(n+=c?i:-i),i=0,n}),a.forEach(e=>{let t;e.forEach(e=>{let r=s[e];if(u.setNode(r),t){var n=s[t],i=u.edge(n,r);u.setEdge(n,r,Math.max(p(l,e,t),i||0))}t=e})}),u),x=o?"borderLeft":"borderRight";function w(e,t){let r=y.nodes(),n=r.pop(),i={};for(;n;)i[n]?e(n):(i[n]=!0,r.push(n),r=r.concat(t(n))),n=r.pop()}return w(function(e){m[e]=y.inEdges(e).reduce((e,t)=>Math.max(e,m[t.v]+y.edge(t)),0)},y.predecessors.bind(y)),w(function(t){let r=y.outEdges(t).reduce((e,t)=>Math.min(e,m[t.w]-y.edge(t)),1/0),n=e.node(t);r!==1/0&&n.borderType!==x&&(m[t]=Math.max(m[t],r))},y.successors.bind(y)),Object.keys(i).forEach(e=>m[e]=m[r[e]]),m}function f(e,t){return Object.values(t).reduce((t,r)=>{let n=-1/0,i=1/0;Object.entries(r).forEach(([t,r])=>{var o,l;let a=(o=e,l=t,o.node(l).width/2);n=Math.max(r+a,n),i=Math.min(r-a,i)});let o=n-i;return o<t[0]&&(t=[o,r]),t},[1/0,null])[1]}function c(e,t){let r=Object.values(t),n=i.applyWithChunking(Math.min,r),o=i.applyWithChunking(Math.max,r);["u","d"].forEach(r=>{["l","r"].forEach(l=>{let a=r+l,s=e[a];if(s===t)return;let h=Object.values(s),d=n-i.applyWithChunking(Math.min,h);"l"!==l&&(d=o-i.applyWithChunking(Math.max,h)),d&&(e[a]=i.mapValues(s,e=>e+d))})})}function u(e,t){return i.mapValues(e.ul,(r,n)=>{if(t)return e[t.toLowerCase()][n];{let t=Object.values(e).map(e=>e[n]).sort((e,t)=>e-t);return(t[1]+t[2])/2}})}t.exports={positionX:function(e){let t,r=i.buildLayerMatrix(e),n=Object.assign(o(e,r),l(e,r)),a={};["u","d"].forEach(o=>{t="u"===o?r:Object.values(r).reverse(),["l","r"].forEach(r=>{"r"===r&&(t=t.map(e=>Object.values(e).reverse()));let l=("u"===o?e.predecessors:e.successors).bind(e),s=h(e,t,n,l),f=d(e,t,s.root,s.align,"r"===r);"r"===r&&(f=i.mapValues(f,e=>-e)),a[o+r]=f})});let s=f(e,a);return c(a,s),u(a,e.graph().align)},findType1Conflicts:o,findType2Conflicts:l,addConflict:a,hasConflict:s,verticalAlignment:h,horizontalCompaction:d,alignCoordinates:c,findSmallestWidthAlignment:f,balance:u}},{"../util":27,"@dagrejs/graphlib":29}],22:[function(e,t,r){"use strict";let n=e("../util"),i=e("./bk").positionX;t.exports=function(e){var t;let r,o,l;t=e=n.asNonCompoundGraph(e),r=n.buildLayerMatrix(t),o=t.graph().ranksep,l=0,r.forEach(e=>{let r=e.reduce((e,r)=>{let n=t.node(r).height;return e>n?e:n},0);e.forEach(e=>t.node(e).y=l+r/2),l+=r+o}),Object.entries(i(e)).forEach(([t,r])=>e.node(t).x=r)}},{"../util":27,"./bk":21}],23:[function(e,t,r){"use strict";var n=e("@dagrejs/graphlib").Graph,i=e("./util").slack;t.exports=function(e){var t,r,o,l,a=new n({directed:!1}),s=e.nodes()[0],h=e.nodeCount();for(a.setNode(s,{});t=a,r=e,t.nodes().forEach(function e(n){r.nodeEdges(n).forEach(o=>{var l=o.v,a=n===l?o.w:l;t.hasNode(a)||i(r,o)||(t.setNode(a,{}),t.setEdge(n,a,{}),e(a))})}),t.nodeCount()<h;)o=function(e,t){return t.edges().reduce((r,n)=>{let o=1/0;return(e.hasNode(n.v)!==e.hasNode(n.w)&&(o=i(t,n)),o<r[0])?[o,n]:r},[1/0,null])[1]}(a,e),l=a.hasNode(o.v)?i(e,o):-i(e,o),function(e,t,r){e.nodes().forEach(e=>t.node(e).rank+=r)}(a,e,l);return a}},{"./util":26,"@dagrejs/graphlib":29}],24:[function(e,t,r){"use strict";var n=e("./util").longestPath,i=e("./feasible-tree"),o=e("./network-simplex");t.exports=function(e){var t,r=e.graph().ranker;if(r instanceof Function)return r(e);switch(e.graph().ranker){case"network-simplex":default:o(e);break;case"tight-tree":n(t=e),i(t);break;case"longest-path":l(e);case"none":}};var l=n},{"./feasible-tree":23,"./network-simplex":25,"./util":26}],25:[function(e,t,r){"use strict";var n=e("./feasible-tree"),i=e("./util").slack,o=e("./util").longestPath,l=e("@dagrejs/graphlib").alg.preorder,a=e("@dagrejs/graphlib").alg.postorder,s=e("../util").simplify;function h(e){o(e=s(e));var t,r,i=n(e);for(c(i),d(i,e);t=u(i);)r=g(i,e,t),p(i,e,t,r)}function d(e,t){var r=a(e,e.nodes());(r=r.slice(0,r.length-1)).forEach(r=>{var n,i,o,l;return n=e,i=t,o=r,l=n.node(o).parent,void(n.edge(o,l).cutvalue=f(n,i,o))})}function f(e,t,r){var n=e.node(r).parent,i=!0,o=t.edge(r,n),l=0;return o||(i=!1,o=t.edge(n,r)),l=o.weight,t.nodeEdges(r).forEach(o=>{var a=o.v===r,s=a?o.w:o.v;if(s!==n){var h,d,f,c=a===i,u=t.edge(o).weight;if(l+=c?u:-u,h=e,d=r,f=s,h.hasEdge(d,f)){var g=e.edge(r,s).cutvalue;l+=c?-g:g}}}),l}function c(e,t){arguments.length<2&&(t=e.nodes()[0]),function e(t,r,n,i,o){var l=n,a=t.node(i);return r[i]=!0,t.neighbors(i).forEach(o=>{Object.hasOwn(r,o)||(n=e(t,r,n,o,i))}),a.low=l,a.lim=n++,o?a.parent=o:delete a.parent,n}(e,{},1,t)}function u(e){return e.edges().find(t=>e.edge(t).cutvalue<0)}function g(e,t,r){var n=r.v,o=r.w;t.hasEdge(n,o)||(n=r.w,o=r.v);var l=e.node(n),a=e.node(o),s=l,h=!1;return l.lim>a.lim&&(s=a,h=!0),t.edges().filter(t=>h===m(e,e.node(t.v),s)&&h!==m(e,e.node(t.w),s)).reduce((e,r)=>i(t,r)<i(t,e)?r:e)}function p(e,t,r,n){var i,o,a,s,h=r.v,f=r.w;e.removeEdge(h,f),e.setEdge(n.v,n.w,{}),c(e),d(e,t),i=e,o=t,a=i.nodes().find(e=>!o.node(e).parent),(s=(s=l(i,a)).slice(1)).forEach(e=>{var t=i.node(e).parent,r=o.edge(e,t),n=!1;r||(r=o.edge(t,e),n=!0),o.node(e).rank=o.node(t).rank+(n?r.minlen:-r.minlen)})}function m(e,t,r){return r.low<=t.lim&&t.lim<=r.lim}t.exports=h,h.initLowLimValues=c,h.initCutValues=d,h.calcCutValue=f,h.leaveEdge=u,h.enterEdge=g,h.exchangeEdges=p},{"../util":27,"./feasible-tree":23,"./util":26,"@dagrejs/graphlib":29}],26:[function(e,t,r){"use strict";let{applyWithChunking:n}=e("../util");t.exports={longestPath:function(e){var t={};e.sources().forEach(function r(i){var o=e.node(i);if(Object.hasOwn(t,i))return o.rank;t[i]=!0;var l=n(Math.min,e.outEdges(i).map(t=>null==t?1/0:r(t.w)-e.edge(t).minlen));return l===1/0&&(l=0),o.rank=l})},slack:function(e,t){return e.node(t.w).rank-e.node(t.v).rank-e.edge(t).minlen}}},{"../util":27}],27:[function(e,t,r){"use strict";let n=e("@dagrejs/graphlib").Graph;function i(e,t,r,n){for(var i=n;e.hasNode(i);)i=s(n);return r.dummy=t,e.setNode(i,r),i}t.exports={addBorderNode:function(e,t,r,n){let o={width:0,height:0};return arguments.length>=4&&(o.rank=r,o.order=n),i(e,"border",o,t)},addDummyNode:i,applyWithChunking:o,asNonCompoundGraph:function(e){let t=new n({multigraph:e.isMultigraph()}).setGraph(e.graph());return e.nodes().forEach(r=>{e.children(r).length||t.setNode(r,e.node(r))}),e.edges().forEach(r=>{t.setEdge(r,e.edge(r))}),t},buildLayerMatrix:function(e){let t=h(l(e)+1).map(()=>[]);return e.nodes().forEach(r=>{let n=e.node(r),i=n.rank;void 0!==i&&(t[i][n.order]=r)}),t},intersectRect:function(e,t){let r,n,i=e.x,o=e.y,l=t.x-i,a=t.y-o,s=e.width/2,h=e.height/2;if(!l&&!a)throw Error("Not possible to find intersection inside of the rectangle");return Math.abs(a)*s>Math.abs(l)*h?(a<0&&(h=-h),r=h*l/a,n=h):(l<0&&(s=-s),r=s,n=s*a/l),{x:i+r,y:o+n}},mapValues:function(e,t){let r=t;return"string"==typeof t&&(r=e=>e[t]),Object.entries(e).reduce((e,[t,n])=>(e[t]=r(n,t),e),{})},maxRank:l,normalizeRanks:function(e){let t=o(Math.min,e.nodes().map(t=>{let r=e.node(t).rank;return void 0===r?Number.MAX_VALUE:r}));e.nodes().forEach(r=>{let n=e.node(r);Object.hasOwn(n,"rank")&&(n.rank-=t)})},notime:function(e,t){return t()},partition:function(e,t){let r={lhs:[],rhs:[]};return e.forEach(e=>{t(e)?r.lhs.push(e):r.rhs.push(e)}),r},pick:function(e,t){let r={};for(let n of t)void 0!==e[n]&&(r[n]=e[n]);return r},predecessorWeights:function(e){let t=e.nodes().map(t=>{let r={};return e.inEdges(t).forEach(t=>{r[t.v]=(r[t.v]||0)+e.edge(t).weight}),r});return d(e.nodes(),t)},range:h,removeEmptyRanks:function(e){let t=o(Math.min,e.nodes().map(t=>e.node(t).rank)),r=[];e.nodes().forEach(n=>{let i=e.node(n).rank-t;r[i]||(r[i]=[]),r[i].push(n)});let n=0,i=e.graph().nodeRankFactor;Array.from(r).forEach((t,r)=>{void 0===t&&r%i!=0?--n:void 0!==t&&n&&t.forEach(t=>e.node(t).rank+=n)})},simplify:function(e){let t=new n().setGraph(e.graph());return e.nodes().forEach(r=>t.setNode(r,e.node(r))),e.edges().forEach(r=>{let n=t.edge(r.v,r.w)||{weight:0,minlen:1},i=e.edge(r);t.setEdge(r.v,r.w,{weight:n.weight+i.weight,minlen:Math.max(n.minlen,i.minlen)})}),t},successorWeights:function(e){let t=e.nodes().map(t=>{let r={};return e.outEdges(t).forEach(t=>{r[t.w]=(r[t.w]||0)+e.edge(t).weight}),r});return d(e.nodes(),t)},time:function(e,t){let r=Date.now();try{return t()}finally{console.log(e+" time: "+(Date.now()-r)+"ms")}},uniqueId:s,zipObject:d};function o(e,t){if(!(t.length>65535))return e.apply(null,t);{let r=function(e,t=65535){let r=[];for(let n=0;n<e.length;n+=t){let i=e.slice(n,n+t);r.push(i)}return r}(t);return e.apply(null,r.map(t=>e.apply(null,t)))}}function l(e){return o(Math.max,e.nodes().map(t=>{let r=e.node(t).rank;return void 0===r?5e-324:r}))}let a=0;function s(e){return e+""+ ++a}function h(e,t,r=1){null==t&&(t=e,e=0);let n=e=>e<t;r<0&&(n=e=>t<e);let i=[];for(let t=e;n(t);t+=r)i.push(t);return i}function d(e,t){return e.reduce((e,r,n)=>(e[r]=t[n],e),{})}},{"@dagrejs/graphlib":29}],28:[function(e,t,r){t.exports="1.1.8"},{}],29:[function(e,t,r){var n=e("./lib");t.exports={Graph:n.Graph,json:e("./lib/json"),alg:e("./lib/alg"),version:n.version}},{"./lib":45,"./lib/alg":36,"./lib/json":46}],30:[function(e,t,r){t.exports=function(e){var t,r={},n=[];return e.nodes().forEach(function(i){t=[],function n(i){Object.hasOwn(r,i)||(r[i]=!0,t.push(i),e.successors(i).forEach(n),e.predecessors(i).forEach(n))}(i),t.length&&n.push(t)}),n}},{}],31:[function(e,t,r){function n(e,t,r,n){for(var i=[[e,!1]];i.length>0;){var l=i.pop();l[1]?n.push(l[0]):Object.hasOwn(r,l[0])||(r[l[0]]=!0,i.push([l[0],!0]),o(t(l[0]),e=>i.push([e,!1])))}}function i(e,t,r,n){for(var i=[e];i.length>0;){var l=i.pop();Object.hasOwn(r,l)||(r[l]=!0,n.push(l),o(t(l),e=>i.push(e)))}}function o(e,t){for(var r=e.length;r--;)t(e[r],r,e);return e}t.exports=function(e,t,r){Array.isArray(t)||(t=[t]);var o=e.isDirected()?t=>e.successors(t):t=>e.neighbors(t),l="post"===r?n:i,a=[],s={};return t.forEach(t=>{if(!e.hasNode(t))throw Error("Graph does not have node: "+t);l(t,o,s,a)}),a}},{}],32:[function(e,t,r){var n=e("./dijkstra");t.exports=function(e,t,r){return e.nodes().reduce(function(i,o){return i[o]=n(e,o,t,r),i},{})}},{"./dijkstra":33}],33:[function(e,t,r){var n=e("../data/priority-queue");t.exports=function(e,t,r,o){return function(e,t,r,i){var o,l,a={},s=new n,h=function(e){var t=e.v!==o?e.v:e.w,n=a[t],i=r(e),h=l.distance+i;if(i<0)throw Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+i);h<n.distance&&(n.distance=h,n.predecessor=o,s.decrease(t,h))};for(e.nodes().forEach(function(e){var r=e===t?0:1/0;a[e]={distance:r},s.add(e,r)});s.size()>0&&(l=a[o=s.removeMin()]).distance!==1/0;)i(o).forEach(h);return a}(e,String(t),r||i,o||function(t){return e.outEdges(t)})};var i=()=>1},{"../data/priority-queue":43}],34:[function(e,t,r){var n=e("./tarjan");t.exports=function(e){return n(e).filter(function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])})}},{"./tarjan":41}],35:[function(e,t,r){t.exports=function(e,t,r){var i,o,l,a,s;return i=e,o=t||n,l=r||function(t){return e.outEdges(t)},a={},(s=i.nodes()).forEach(function(e){a[e]={},a[e][e]={distance:0},s.forEach(function(t){e!==t&&(a[e][t]={distance:1/0})}),l(e).forEach(function(t){var r=t.v===e?t.w:t.v,n=o(t);a[e][r]={distance:n,predecessor:e}})}),s.forEach(function(e){var t=a[e];s.forEach(function(r){var n=a[r];s.forEach(function(r){var i=n[e],o=t[r],l=n[r],a=i.distance+o.distance;a<l.distance&&(l.distance=a,l.predecessor=o.predecessor)})})}),a};var n=()=>1},{}],36:[function(e,t,r){t.exports={components:e("./components"),dijkstra:e("./dijkstra"),dijkstraAll:e("./dijkstra-all"),findCycles:e("./find-cycles"),floydWarshall:e("./floyd-warshall"),isAcyclic:e("./is-acyclic"),postorder:e("./postorder"),preorder:e("./preorder"),prim:e("./prim"),tarjan:e("./tarjan"),topsort:e("./topsort")}},{"./components":30,"./dijkstra":33,"./dijkstra-all":32,"./find-cycles":34,"./floyd-warshall":35,"./is-acyclic":37,"./postorder":38,"./preorder":39,"./prim":40,"./tarjan":41,"./topsort":42}],37:[function(e,t,r){var n=e("./topsort");t.exports=function(e){try{n(e)}catch(e){if(e instanceof n.CycleException)return!1;throw e}return!0}},{"./topsort":42}],38:[function(e,t,r){var n=e("./dfs");t.exports=function(e,t){return n(e,t,"post")}},{"./dfs":31}],39:[function(e,t,r){var n=e("./dfs");t.exports=function(e,t){return n(e,t,"pre")}},{"./dfs":31}],40:[function(e,t,r){var n=e("../graph"),i=e("../data/priority-queue");t.exports=function(e,t){var r,o=new n,l={},a=new i;function s(e){var n=e.v===r?e.w:e.v,i=a.priority(n);if(void 0!==i){var o=t(e);o<i&&(l[n]=r,a.decrease(n,o))}}if(0===e.nodeCount())return o;e.nodes().forEach(function(e){a.add(e,1/0),o.setNode(e)}),a.decrease(e.nodes()[0],0);for(var h=!1;a.size()>0;){if(Object.hasOwn(l,r=a.removeMin()))o.setEdge(r,l[r]);else if(h)throw Error("Input graph is not connected: "+e);else h=!0;e.nodeEdges(r).forEach(s)}return o}},{"../data/priority-queue":43,"../graph":44}],41:[function(e,t,r){t.exports=function(e){var t=0,r=[],n={},i=[];return e.nodes().forEach(function(o){Object.hasOwn(n,o)||function o(l){var a=n[l]={onStack:!0,lowlink:t,index:t++};if(r.push(l),e.successors(l).forEach(function(e){Object.hasOwn(n,e)?n[e].onStack&&(a.lowlink=Math.min(a.lowlink,n[e].index)):(o(e),a.lowlink=Math.min(a.lowlink,n[e].lowlink))}),a.lowlink===a.index){var s,h=[];do n[s=r.pop()].onStack=!1,h.push(s);while(l!==s)i.push(h)}}(o)}),i}},{}],42:[function(e,t,r){function n(e){var t={},r={},n=[];if(e.sinks().forEach(function o(l){if(Object.hasOwn(r,l))throw new i;Object.hasOwn(t,l)||(r[l]=!0,t[l]=!0,e.predecessors(l).forEach(o),delete r[l],n.push(l))}),Object.keys(t).length!==e.nodeCount())throw new i;return n}class i extends Error{constructor(){super(...arguments)}}t.exports=n,n.CycleException=i},{}],43:[function(e,t,r){t.exports=class{_arr=[];_keyIndices={};size(){return this._arr.length}keys(){return this._arr.map(function(e){return e.key})}has(e){return Object.hasOwn(this._keyIndices,e)}priority(e){var t=this._keyIndices[e];if(void 0!==t)return this._arr[t].priority}min(){if(0===this.size())throw Error("Queue underflow");return this._arr[0].key}add(e,t){var r=this._keyIndices;if(!Object.hasOwn(r,e=String(e))){var n=this._arr,i=n.length;return r[e]=i,n.push({key:e,priority:t}),this._decrease(i),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key}decrease(e,t){var r=this._keyIndices[e];if(t>this._arr[r].priority)throw Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[r].priority+" New: "+t);this._arr[r].priority=t,this._decrease(r)}_heapify(e){var t=this._arr,r=2*e,n=r+1,i=e;r<t.length&&(i=t[r].priority<t[i].priority?r:i,n<t.length&&(i=t[n].priority<t[i].priority?n:i),i!==e&&(this._swap(e,i),this._heapify(i)))}_decrease(e){for(var t,r=this._arr,n=r[e].priority;0!==e&&!(r[t=e>>1].priority<n);)this._swap(e,t),e=t}_swap(e,t){var r=this._arr,n=this._keyIndices,i=r[e],o=r[t];r[e]=o,r[t]=i,n[o.key]=e,n[i.key]=t}}},{}],44:[function(e,t,r){"use strict";function n(e,t){e[t]?e[t]++:e[t]=1}function i(e,t){--e[t]||delete e[t]}function o(e,t,r,n){var i=""+t,o=""+r;if(!e&&i>o){var l=i;i=o,o=l}return i+"\x01"+o+"\x01"+(void 0===n?"\0":n)}function l(e,t){return o(e,t.v,t.w,t.name)}t.exports=class{_isDirected=!0;_isMultigraph=!1;_isCompound=!1;_label;_defaultNodeLabelFn=()=>void 0;_defaultEdgeLabelFn=()=>void 0;_nodes={};_in={};_preds={};_out={};_sucs={};_edgeObjs={};_edgeLabels={};_nodeCount=0;_edgeCount=0;_parent;_children;constructor(e){e&&(this._isDirected=!Object.hasOwn(e,"directed")||e.directed,this._isMultigraph=!!Object.hasOwn(e,"multigraph")&&e.multigraph,this._isCompound=!!Object.hasOwn(e,"compound")&&e.compound),this._isCompound&&(this._parent={},this._children={},this._children["\0"]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(e){return this._label=e,this}graph(){return this._label}setDefaultNodeLabel(e){return this._defaultNodeLabelFn=e,"function"!=typeof e&&(this._defaultNodeLabelFn=()=>e),this}nodeCount(){return this._nodeCount}nodes(){return Object.keys(this._nodes)}sources(){var e=this;return this.nodes().filter(t=>0===Object.keys(e._in[t]).length)}sinks(){var e=this;return this.nodes().filter(t=>0===Object.keys(e._out[t]).length)}setNodes(e,t){var r=arguments,n=this;return e.forEach(function(e){r.length>1?n.setNode(e,t):n.setNode(e)}),this}setNode(e,t){return Object.hasOwn(this._nodes,e)?arguments.length>1&&(this._nodes[e]=t):(this._nodes[e]=arguments.length>1?t:this._defaultNodeLabelFn(e),this._isCompound&&(this._parent[e]="\0",this._children[e]={},this._children["\0"][e]=!0),this._in[e]={},this._preds[e]={},this._out[e]={},this._sucs[e]={},++this._nodeCount),this}node(e){return this._nodes[e]}hasNode(e){return Object.hasOwn(this._nodes,e)}removeNode(e){var t=this;if(Object.hasOwn(this._nodes,e)){var r=e=>t.removeEdge(t._edgeObjs[e]);delete this._nodes[e],this._isCompound&&(this._removeFromParentsChildList(e),delete this._parent[e],this.children(e).forEach(function(e){t.setParent(e)}),delete this._children[e]),Object.keys(this._in[e]).forEach(r),delete this._in[e],delete this._preds[e],Object.keys(this._out[e]).forEach(r),delete this._out[e],delete this._sucs[e],--this._nodeCount}return this}setParent(e,t){if(!this._isCompound)throw Error("Cannot set parent in a non-compound graph");if(void 0===t)t="\0";else{t+="";for(var r=t;void 0!==r;r=this.parent(r))if(r===e)throw Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this}_removeFromParentsChildList(e){delete this._children[this._parent[e]][e]}parent(e){if(this._isCompound){var t=this._parent[e];if("\0"!==t)return t}}children(e="\0"){if(this._isCompound){var t=this._children[e];if(t)return Object.keys(t)}else if("\0"===e)return this.nodes();else if(this.hasNode(e))return[]}predecessors(e){var t=this._preds[e];if(t)return Object.keys(t)}successors(e){var t=this._sucs[e];if(t)return Object.keys(t)}neighbors(e){var t=this.predecessors(e);if(t){let n=new Set(t);for(var r of this.successors(e))n.add(r);return Array.from(n.values())}}isLeaf(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length}filterNodes(e){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var r=this;Object.entries(this._nodes).forEach(function([r,n]){e(r)&&t.setNode(r,n)}),Object.values(this._edgeObjs).forEach(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,r.edge(e))});var n={};return this._isCompound&&t.nodes().forEach(e=>t.setParent(e,function e(i){var o=r.parent(i);return void 0===o||t.hasNode(o)?(n[i]=o,o):o in n?n[o]:e(o)}(e))),t}setDefaultEdgeLabel(e){return this._defaultEdgeLabelFn=e,"function"!=typeof e&&(this._defaultEdgeLabelFn=()=>e),this}edgeCount(){return this._edgeCount}edges(){return Object.values(this._edgeObjs)}setPath(e,t){var r=this,n=arguments;return e.reduce(function(e,i){return n.length>1?r.setEdge(e,i,t):r.setEdge(e,i),i}),this}setEdge(){var e,t,r,i,l=!1,a=arguments[0];"object"==typeof a&&null!==a&&"v"in a?(e=a.v,t=a.w,r=a.name,2==arguments.length&&(i=arguments[1],l=!0)):(e=a,t=arguments[1],r=arguments[3],arguments.length>2&&(i=arguments[2],l=!0)),e=""+e,t=""+t,void 0!==r&&(r=""+r);var s=o(this._isDirected,e,t,r);if(Object.hasOwn(this._edgeLabels,s))return l&&(this._edgeLabels[s]=i),this;if(void 0!==r&&!this._isMultigraph)throw Error("Cannot set a named edge when isMultigraph = false");this.setNode(e),this.setNode(t),this._edgeLabels[s]=l?i:this._defaultEdgeLabelFn(e,t,r);var h=function(e,t,r,n){var i=""+t,o=""+r;if(!e&&i>o){var l=i;i=o,o=l}var a={v:i,w:o};return n&&(a.name=n),a}(this._isDirected,e,t,r);return e=h.v,t=h.w,Object.freeze(h),this._edgeObjs[s]=h,n(this._preds[t],e),n(this._sucs[e],t),this._in[t][s]=h,this._out[e][s]=h,this._edgeCount++,this}edge(e,t,r){var n=1==arguments.length?l(this._isDirected,arguments[0]):o(this._isDirected,e,t,r);return this._edgeLabels[n]}edgeAsObj(){let e=this.edge(...arguments);return"object"!=typeof e?{label:e}:e}hasEdge(e,t,r){var n=1==arguments.length?l(this._isDirected,arguments[0]):o(this._isDirected,e,t,r);return Object.hasOwn(this._edgeLabels,n)}removeEdge(e,t,r){var n=1==arguments.length?l(this._isDirected,arguments[0]):o(this._isDirected,e,t,r),a=this._edgeObjs[n];return a&&(e=a.v,t=a.w,delete this._edgeLabels[n],delete this._edgeObjs[n],i(this._preds[t],e),i(this._sucs[e],t),delete this._in[t][n],delete this._out[e][n],this._edgeCount--),this}inEdges(e,t){var r=this._in[e];if(r){var n=Object.values(r);return t?n.filter(e=>e.v===t):n}}outEdges(e,t){var r=this._out[e];if(r){var n=Object.values(r);return t?n.filter(e=>e.w===t):n}}nodeEdges(e,t){var r=this.inEdges(e,t);if(r)return r.concat(this.outEdges(e,t))}}},{}],45:[function(e,t,r){t.exports={Graph:e("./graph"),version:e("./version")}},{"./graph":44,"./version":47}],46:[function(e,t,r){var n=e("./graph");t.exports={write:function(e){var t,r,n={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:(t=e).nodes().map(function(e){var r=t.node(e),n=t.parent(e),i={v:e};return void 0!==r&&(i.value=r),void 0!==n&&(i.parent=n),i}),edges:(r=e).edges().map(function(e){var t=r.edge(e),n={v:e.v,w:e.w};return void 0!==e.name&&(n.name=e.name),void 0!==t&&(n.value=t),n})};return void 0!==e.graph()&&(n.value=structuredClone(e.graph())),n},read:function(e){var t=new n(e.options).setGraph(e.value);return e.nodes.forEach(function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)}),e.edges.forEach(function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)}),t}}},{"./graph":44}],47:[function(e,t,r){t.exports="2.2.4"},{}]},{},[1])(1)},48795,e=>{"use strict";var t=e.i(85473),r={bg:"#FFFFFF",fg:"#27272A"},n={"zinc-dark":{bg:"#18181B",fg:"#FAFAFA"},"tokyo-night":{bg:"#1a1b26",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-storm":{bg:"#24283b",fg:"#a9b1d6",line:"#3d59a1",accent:"#7aa2f7",muted:"#565f89"},"tokyo-night-light":{bg:"#d5d6db",fg:"#343b58",line:"#34548a",accent:"#34548a",muted:"#9699a3"},"catppuccin-mocha":{bg:"#1e1e2e",fg:"#cdd6f4",line:"#585b70",accent:"#cba6f7",muted:"#6c7086"},"catppuccin-latte":{bg:"#eff1f5",fg:"#4c4f69",line:"#9ca0b0",accent:"#8839ef",muted:"#9ca0b0"},nord:{bg:"#2e3440",fg:"#d8dee9",line:"#4c566a",accent:"#88c0d0",muted:"#616e88"},"nord-light":{bg:"#eceff4",fg:"#2e3440",line:"#aab1c0",accent:"#5e81ac",muted:"#7b88a1"},dracula:{bg:"#282a36",fg:"#f8f8f2",line:"#6272a4",accent:"#bd93f9",muted:"#6272a4"},"github-light":{bg:"#ffffff",fg:"#1f2328",line:"#d1d9e0",accent:"#0969da",muted:"#59636e"},"github-dark":{bg:"#0d1117",fg:"#e6edf3",line:"#3d444d",accent:"#4493f8",muted:"#9198a1"},"solarized-light":{bg:"#fdf6e3",fg:"#657b83",line:"#93a1a1",accent:"#268bd2",muted:"#93a1a1"},"solarized-dark":{bg:"#002b36",fg:"#839496",line:"#586e75",accent:"#268bd2",muted:"#586e75"},"one-dark":{bg:"#282c34",fg:"#abb2bf",line:"#4b5263",accent:"#c678dd",muted:"#5c6370"}};function i(e){let t=e.colors??{},r="dark"===e.type,n=t=>e.tokenColors?.find(e=>Array.isArray(e.scope)?e.scope.includes(t):e.scope===t)?.settings?.foreground;return{bg:t["editor.background"]??(r?"#1e1e1e":"#ffffff"),fg:t["editor.foreground"]??(r?"#d4d4d4":"#333333"),line:t["editorLineNumber.foreground"]??void 0,accent:t.focusBorder??n("keyword")??void 0,muted:n("comment")??t["editorLineNumber.foreground"]??void 0,surface:t["editor.selectionBackground"]??void 0,border:t["editorWidget.border"]??void 0}}function o(e,t){let r=[`@import url('https://fonts.googleapis.com/css2?family=${encodeURIComponent(e)}:wght@400;500;600;700&amp;display=swap');`,...t?["@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&amp;display=swap');"]:[]],n=`
    /* Derived from --bg and --fg (overridable via --line, --accent, etc.) */
    --_text:          var(--fg);
    --_text-sec:      var(--muted, color-mix(in srgb, var(--fg) 60%, var(--bg)));
    --_text-muted:    var(--muted, color-mix(in srgb, var(--fg) 40%, var(--bg)));
    --_text-faint:    color-mix(in srgb, var(--fg) 25%, var(--bg));
    --_line:          var(--line, color-mix(in srgb, var(--fg) 30%, var(--bg)));
    --_arrow:         var(--accent, color-mix(in srgb, var(--fg) 50%, var(--bg)));
    --_node-fill:     var(--surface, color-mix(in srgb, var(--fg) 3%, var(--bg)));
    --_node-stroke:   var(--border, color-mix(in srgb, var(--fg) 20%, var(--bg)));
    --_group-fill:    var(--bg);
    --_group-hdr:     color-mix(in srgb, var(--fg) 5%, var(--bg));
    --_inner-stroke:  color-mix(in srgb, var(--fg) 12%, var(--bg));
    --_key-badge:     color-mix(in srgb, var(--fg) 10%, var(--bg));`;return["<style>",`  ${r.join("\n  ")}`,`  text { font-family: '${e}', system-ui, sans-serif; }`,...t?["  .mono { font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', ui-monospace, monospace; }"]:[],`  svg {${n}`,"  }","</style>"].join("\n")}function l(e,t,r,n){let i=[`--bg:${r.bg}`,`--fg:${r.fg}`,r.line?`--line:${r.line}`:"",r.accent?`--accent:${r.accent}`:"",r.muted?`--muted:${r.muted}`:"",r.surface?`--surface:${r.surface}`:"",r.border?`--border:${r.border}`:""].filter(Boolean).join(";");return`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${e} ${t}" width="${e}" height="${t}" style="${i}${n?"":";background:var(--bg)"}">`}function a(e){let t=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("%%"));if(0===t.length)throw Error("Empty mermaid diagram");let r=t[0];return/^stateDiagram(-v2)?\s*$/i.test(r)?function(e){let t={direction:"TD",nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},r=[],n=0,i=0;for(let o=1;o<e.length;o++){let l=e[o],a=l.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(a){r.length>0?r[r.length-1].direction=a[1].toUpperCase():t.direction=a[1].toUpperCase();continue}let d=l.match(/^state\s+(?:"([^"]+)"\s+as\s+)?(\w+)\s*\{$/);if(d){let e=d[1]??d[2],t={id:d[2],label:e,nodeIds:[],children:[]};r.push(t);continue}if("}"===l){let e=r.pop();e&&(r.length>0?r[r.length-1].children.push(e):t.subgraphs.push(e));continue}let f=l.match(/^state\s+"([^"]+)"\s+as\s+(\w+)\s*$/);if(f){let e=f[1];s(t,r,{id:f[2],label:e,shape:"rounded"});continue}let c=l.match(/^(\[\*\]|[\w-]+)\s*(-->)\s*(\[\*\]|[\w-]+)(?:\s*:\s*(.+))?$/);if(c){let e=c[1],o=c[3],l=c[4]?.trim()||void 0;"[*]"===e?(n++,s(t,r,{id:e=`_start${n>1?n:""}`,label:"",shape:"state-start"})):h(t,r,e),"[*]"===o?(i++,s(t,r,{id:o=`_end${i>1?i:""}`,label:"",shape:"state-end"})):h(t,r,o),t.edges.push({source:e,target:o,label:l,style:"solid",hasArrowStart:!1,hasArrowEnd:!0});continue}let u=l.match(/^([\w-]+)\s*:\s*(.+)$/);if(u){s(t,r,{id:u[1],label:u[2].trim(),shape:"rounded"});continue}}return t}(t):function(e){let t=e[0].match(/^(?:graph|flowchart)\s+(TD|TB|LR|BT|RL)\s*$/i);if(!t)throw Error(`Invalid mermaid header: "${e[0]}". Expected "graph TD", "flowchart LR", "stateDiagram-v2", etc.`);let r={direction:t[1].toUpperCase(),nodes:new Map,edges:[],subgraphs:[],classDefs:new Map,classAssignments:new Map,nodeStyles:new Map},n=[];for(let t=1;t<e.length;t++){let i=e[t],o=i.match(/^classDef\s+(\w+)\s+(.+)$/);if(o){let e=o[1],t=d(o[2]);r.classDefs.set(e,t);continue}let l=i.match(/^class\s+([\w,-]+)\s+(\w+)$/);if(l){let e=l[1].split(",").map(e=>e.trim()),t=l[2];for(let n of e)r.classAssignments.set(n,t);continue}let a=i.match(/^style\s+([\w,-]+)\s+(.+)$/);if(a){let e=a[1].split(",").map(e=>e.trim()),t=d(a[2]);for(let n of e)r.nodeStyles.set(n,{...r.nodeStyles.get(n),...t});continue}let s=i.match(/^direction\s+(TD|TB|LR|BT|RL)\s*$/i);if(s&&n.length>0){n[n.length-1].direction=s[1].toUpperCase();continue}let h=i.match(/^subgraph\s+(.+)$/);if(h){let e,t,r=h[1].trim(),i=r.match(/^([\w-]+)\s*\[(.+)\]$/);i?(e=i[1],t=i[2]):(t=r,e=r.replace(/\s+/g,"_").replace(/[^\w]/g,""));let o={id:e,label:t,nodeIds:[],children:[]};n.push(o);continue}if("end"===i){let e=n.pop();e&&(n.length>0?n[n.length-1].children.push(e):r.subgraphs.push(e));continue}!function(e,t,r){let n=e.trim(),i=p(n,t,r);if(!i||0===i.ids.length)return;n=i.remaining.trim();let o=i.ids;for(;n.length>0;){var l;let e=n.match(f);if(!e)break;let i=!!e[1],a=e[2],s=e[3]?.trim()||void 0;n=n.slice(e[0].length).trim();let h="-.->"===(l=a)||"-.-"===l?"dotted":"==>"===l||"==="===l?"thick":"solid",d=a.endsWith(">"),c=p(n,t,r);if(!c||0===c.ids.length)break;for(let e of(n=c.remaining.trim(),o))for(let r of c.ids)t.edges.push({source:e,target:r,label:s,style:h,hasArrowStart:i,hasArrowEnd:d});o=c.ids}}(i,r,n)}return r}(t)}function s(e,t,r){if(e.nodes.has(r.id)||e.nodes.set(r.id,r),t.length>0){let e=t[t.length-1];e.nodeIds.includes(r.id)||e.nodeIds.push(r.id)}}function h(e,t,r){if(e.nodes.has(r)){if(t.length>0){let e=t[t.length-1];e.nodeIds.includes(r)||e.nodeIds.push(r)}}else s(e,t,{id:r,label:r,shape:"rounded"})}function d(e){let t={};for(let r of e.split(",")){let e=r.indexOf(":");if(e>0){let n=r.slice(0,e).trim(),i=r.slice(e+1).trim();n&&i&&(t[n]=i)}}return t}var f=/^(<)?(-->|-.->|==>|---|-\.-|===)(?:\|([^|]*)\|)?/,c=[{regex:/^([\w-]+)\(\(\((.+?)\)\)\)/,shape:"doublecircle"},{regex:/^([\w-]+)\(\[(.+?)\]\)/,shape:"stadium"},{regex:/^([\w-]+)\(\((.+?)\)\)/,shape:"circle"},{regex:/^([\w-]+)\[\[(.+?)\]\]/,shape:"subroutine"},{regex:/^([\w-]+)\[\((.+?)\)\]/,shape:"cylinder"},{regex:/^([\w-]+)\[\/(.+?)\\\]/,shape:"trapezoid"},{regex:/^([\w-]+)\[\\(.+?)\/\]/,shape:"trapezoid-alt"},{regex:/^([\w-]+)>(.+?)\]/,shape:"asymmetric"},{regex:/^([\w-]+)\{\{(.+?)\}\}/,shape:"hexagon"},{regex:/^([\w-]+)\[(.+?)\]/,shape:"rectangle"},{regex:/^([\w-]+)\((.+?)\)/,shape:"rounded"},{regex:/^([\w-]+)\{(.+?)\}/,shape:"diamond"}],u=/^([\w-]+)/,g=/^:::([\w][\w-]*)/;function p(e,t,r){let n=m(e,t,r);if(!n)return null;let i=[n.id],o=n.remaining.trim();for(;o.startsWith("&");){let e=m(o=o.slice(1).trim(),t,r);if(!e)break;i.push(e.id),o=e.remaining.trim()}return{ids:i,remaining:o}}function m(e,t,r){let n=null,i=e;for(let{regex:o,shape:l}of c){let a=e.match(o);if(a){y(t,r,{id:n=a[1],label:a[2],shape:l}),i=e.slice(a[0].length);break}}if(null===n){let o=e.match(u);o&&(n=o[1],t.nodes.has(n)?x(r,n):y(t,r,{id:n,label:n,shape:"rectangle"}),i=e.slice(o[0].length))}if(null===n)return null;let o=i.match(g);return o&&(t.classAssignments.set(n,o[1]),i=i.slice(o[0].length)),{id:n,remaining:i}}function y(e,t,r){e.nodes.has(r.id)||e.nodes.set(r.id,r),x(t,r.id)}function x(e,t){if(e.length>0){let r=e[e.length-1];r.nodeIds.includes(t)||r.nodeIds.push(t)}}var w={x:1,y:0},b={x:1,y:2},v={x:0,y:1},$={x:2,y:1},k={x:2,y:0},M={x:0,y:0},_={x:2,y:2},E={x:0,y:2},j={x:1,y:1};function C(e,t){return e.x===t.x&&e.y===t.y}function O(e,t){return{x:e.x+t.x,y:e.y+t.y}}function L(e){return`${e.x},${e.y}`}var S={name:"",styles:{}};function N(e,t){let r=[];for(let n=0;n<=e;n++){let e=[];for(let r=0;r<=t;r++)e.push(" ");r.push(e)}return r}function A(e){let[t,r]=R(e);return N(t,r)}function R(e){return[e.length-1,(e[0]?.length??1)-1]}function D(e,t,r){let[n,i]=R(e),o=N(Math.max(t,n),Math.max(r,i));for(let t=0;t<o.length;t++)for(let r=0;r<o[0].length;r++)t<e.length&&r<e[0].length&&(o[t][r]=e[t][r]);return e.length=0,e.push(...o),e}var I=new Set(["","","","","","","","","","","","","","",""]),z={"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""},"":{"":"","":"","":"","":"","":"","":"","":"","":"","":""}};function Y(e,t,r,...n){let[i,o]=R(e);for(let e of n){let[r,n]=R(e);i=Math.max(i,r+t.x),o=Math.max(o,n+t.y)}let l=N(i,o);for(let t=0;t<=i;t++)for(let r=0;r<=o;r++)t<e.length&&r<e[0].length&&(l[t][r]=e[t][r]);for(let e of n)for(let n=0;n<e.length;n++)for(let i=0;i<e[0].length;i++){let o=e[n][i];if(" "!==o){let e=n+t.x,a=i+t.y,s=l[e][a];!r&&I.has(o)&&I.has(s)?l[e][a]=z[s]?.[o]??s:l[e][a]=o}}return l}function X(e){let[t,r]=R(e),n=[];for(let i=0;i<=r;i++){let r="";for(let n=0;n<=t;n++)r+=e[n][i];n.push(r)}return n.join("\n")}var W={"":"","":"","":"","":"","":"","":"","^":"v",v:"^","":"","":"","":"","":"","":"","":"","":"","":""},T=class{items=[];get length(){return this.items.length}push(e){this.items.push(e),this.bubbleUp(this.items.length-1)}pop(){if(0===this.items.length)return;let e=this.items[0],t=this.items.pop();return this.items.length>0&&(this.items[0]=t,this.sinkDown(0)),e}bubbleUp(e){for(;e>0;){let t=e-1>>1;if(this.items[e].priority<this.items[t].priority)[this.items[e],this.items[t]]=[this.items[t],this.items[e]],e=t;else break}}sinkDown(e){let t=this.items.length;for(;;){let r=e,n=2*e+1,i=2*e+2;if(n<t&&this.items[n].priority<this.items[r].priority&&(r=n),i<t&&this.items[i].priority<this.items[r].priority&&(r=i),r!==e)[this.items[e],this.items[r]]=[this.items[r],this.items[e]],e=r;else break}}},B=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}];function P(e,t,r){let n=new T;n.push({coord:t,priority:0});let i=new Map;i.set(L(t),0);let o=new Map;for(o.set(L(t),null);n.length>0;){let t=n.pop().coord;if(C(t,r)){let e=[],r=t;for(;null!==r;)e.unshift(r),r=o.get(L(r))??null;return e}let l=i.get(L(t));for(let a of B){let s={x:t.x+a.x,y:t.y+a.y};if((s.x<0||s.y<0||e.has(L(s)))&&!C(s,r))continue;let h=l+1,d=L(s),f=i.get(d);if(void 0===f||h<f){i.set(d,h);let e=h+function(e,t){let r=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y);return 0===r||0===n?r+n:r+n+1}(s,r);n.push({coord:s,priority:e}),o.set(d,t)}}}return null}function G(e){if(e.length<=2)return e;let t=new Set,r=e[0],n=e[1];for(let i=2;i<e.length;i++){let o=e[i],l=n.x-r.x,a=n.y-r.y,s=o.x-n.x,h=o.y-n.y;l===s&&a===h&&t.add(i-1),r=n,n=o}return e.filter((e,r)=>!t.has(r))}function q(e){return e===w?b:e===b?w:e===v?$:e===$?v:e===k?E:e===M?_:e===_?M:e===E?k:j}function H(e,t){return e.x===t.x&&e.y===t.y}function F(e,t){return e.x===t.x?e.y<t.y?b:w:e.y===t.y?e.x<t.x?$:v:e.x<t.x?e.y<t.y?_:k:e.y<t.y?E:M}function U(e,t,r=1){let n=0;for(let t of e)for(let e of t)n=Math.max(n,e.length);let i=n+2*r+2,o=0;for(let t of e)o+=Math.max(t.length,1);let l=o+(e.length-1)+2,a=t?"-":"",s=t?"|":"",h=t?"+":"",d=t?"+":"",f=N(i-1,l-1);f[0][0]=t?"+":"";for(let e=1;e<i-1;e++)f[e][0]=a;f[i-1][0]=t?"+":"",f[0][l-1]=t?"+":"";for(let e=1;e<i-1;e++)f[e][l-1]=a;f[i-1][l-1]=t?"+":"";for(let e=1;e<l-1;e++)f[0][e]=s,f[i-1][e]=s;let c=1;for(let t=0;t<e.length;t++){let n=e[t];for(let e of n.length>0?n:[""]){let t=1+r;for(let r=0;r<e.length;r++)f[t+r][c]=e[r];c++}if(t<e.length-1){f[0][c]=h;for(let e=1;e<i-1;e++)f[e][c]=a;f[i-1][c]=d,c++}}return f}function V(e,t,r){let n=0;for(let r=0;r<t.x;r++)n+=e.columnWidth.get(r)??0;let i=0;for(let r=0;r<t.y;r++)i+=e.rowHeight.get(r)??0;let o=e.columnWidth.get(t.x)??0,l=e.rowHeight.get(t.y)??0;return{x:n+Math.floor(o/2)+e.offsetX,y:i+Math.floor(l/2)+e.offsetY}}function K(e,t,r){if(e.grid.has(L(r)))if("LR"===e.config.graphDirection)return K(e,t,{x:r.x,y:r.y+4});else return K(e,t,{x:r.x+4,y:r.y});for(let n=0;n<3;n++)for(let i=0;i<3;i++){let o={x:r.x+n,y:r.y+i};e.grid.set(L(o),t)}return t.gridCoord=r,r}function J(e,t){return e.subgraphs.some(e=>e.nodes.includes(t))}function Z(e,t){for(let r of e.subgraphs)if(r.nodes.includes(t))return r;return null}function Q(e,t){return e.edges.filter(e=>e.from.name===t.name).map(e=>e.to)}function ee(e){let t={actors:[],messages:[],blocks:[],notes:[]},r=new Set,n=[];for(let i=1;i<e.length;i++){let o=e[i],l=o.match(/^(participant|actor)\s+(\S+?)(?:\s+as\s+(.+))?$/);if(l){let e=l[1],n=l[2],i=l[3]?.trim()??n;r.has(n)||(r.add(n),t.actors.push({id:n,label:i,type:e}));continue}let a=o.match(/^Note\s+(left of|right of|over)\s+([^:]+):\s*(.+)$/i);if(a){let e=a[1].toLowerCase(),n=a[2].trim(),i=a[3].trim(),o=n.split(",").map(e=>e.trim());for(let e of o)et(t,r,e);let l="over";"left of"===e?l="left":"right of"===e&&(l="right"),t.notes.push({actorIds:o,text:i,position:l,afterIndex:t.messages.length-1});continue}let s=o.match(/^(loop|alt|opt|par|critical|break|rect)\s*(.*)$/);if(s){let e=s[1],r=s[2]?.trim()??"";n.push({type:e,label:r,startIndex:t.messages.length,dividers:[]});continue}let h=o.match(/^(else|and)\s*(.*)$/);if(h&&n.length>0){let e=h[2]?.trim()??"";n[n.length-1].dividers.push({index:t.messages.length,label:e});continue}if("end"===o&&n.length>0){let e=n.pop();t.blocks.push({type:e.type,label:e.label,startIndex:e.startIndex,endIndex:Math.max(t.messages.length-1,e.startIndex),dividers:e.dividers});continue}let d=o.match(/^(\S+?)\s*(--?>?>|--?[)x]|--?>>|--?>)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(d){let e=d[1],n=d[2],i=d[3],o=d[4],l=d[5].trim();et(t,r,e),et(t,r,o);let a={from:e,to:o,label:l,lineStyle:n.startsWith("--")?"dashed":"solid",arrowHead:n.includes(">>")||n.includes("x")?"filled":"open"};"+"===i&&(a.activate=!0),"-"===i&&(a.deactivate=!0),t.messages.push(a);continue}let f=o.match(/^(\S+?)\s*(->>|-->>|-\)|--\)|-x|--x|->|-->)\s*([+-]?)(\S+?)\s*:\s*(.+)$/);if(f){let e=f[1],n=f[2],i=f[3],o=f[4],l=f[5].trim();et(t,r,e),et(t,r,o);let a={from:e,to:o,label:l,lineStyle:n.startsWith("--")?"dashed":"solid",arrowHead:n.includes(">>")||n.includes("x")?"filled":"open"};"+"===i&&(a.activate=!0),"-"===i&&(a.deactivate=!0),t.messages.push(a);continue}}return t}function et(e,t,r){t.has(r)||(t.add(r),e.actors.push({id:r,label:r,type:"participant"}))}function er(e){let t={classes:[],relationships:[],namespaces:[]},r=new Map,n=null,i=null,o=0;for(let l=1;l<e.length;l++){let a=e[l];if(i&&o>0){if("}"===a){0==--o&&(i=null);continue}let e=a.match(/^<<(\w+)>>$/);if(e){i.annotation=e[1];continue}let t=ei(a);t&&(t.isMethod?i.methods.push(t.member):i.attributes.push(t.member));continue}let s=a.match(/^namespace\s+(\S+)\s*\{$/);if(s){n={name:s[1],classIds:[]};continue}if("}"===a&&n){t.namespaces.push(n),n=null;continue}let h=a.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*\{$/);if(h){let e=h[1],t=h[2],l=en(r,e);t&&(l.label=`${e}<${t}>`),i=l,o=1,n&&n.classIds.push(e);continue}let d=a.match(/^class\s+(\S+?)(?:\s*~(\w+)~)?\s*$/);if(d){let e=d[1],t=d[2],i=en(r,e);t&&(i.label=`${e}<${t}>`),n&&n.classIds.push(e);continue}let f=a.match(/^class\s+(\S+?)\s*\{\s*<<(\w+)>>\s*\}$/);if(f){en(r,f[1]).annotation=f[2];continue}let c=a.match(/^(\S+?)\s*:\s*(.+)$/);if(c){let e=c[2];if(!e.match(/<\|--|--|\*--|o--|-->|\.\.>|\.\.\|>/)){let t=en(r,c[1]),n=ei(e);n&&(n.isMethod?t.methods.push(n.member):t.attributes.push(n.member));continue}}let u=function(e){let t=e.match(/^(\S+?)\s+(?:"([^"]*?)"\s+)?(<\|--|<\|\.\.|\*--|o--|-->|--\*|--o|--|>\s*|\.\.>|\.\.\|>|--)\s+(?:"([^"]*?)"\s+)?(\S+?)(?:\s*:\s*(.+))?$/);if(!t)return null;let r=t[1],n=t[2]||void 0,i=t[3].trim(),o=t[4]||void 0,l=t[5],a=t[6]?.trim()||void 0,s=function(e){switch(e){case"<|--":return{type:"inheritance",markerAt:"from"};case"<|..":return{type:"realization",markerAt:"from"};case"*--":return{type:"composition",markerAt:"from"};case"--*":return{type:"composition",markerAt:"to"};case"o--":return{type:"aggregation",markerAt:"from"};case"--o":return{type:"aggregation",markerAt:"to"};case"-->":case"--":return{type:"association",markerAt:"to"};case"..>":return{type:"dependency",markerAt:"to"};case"..|>":return{type:"realization",markerAt:"to"};default:return null}}(i);return s?{from:r,to:l,type:s.type,markerAt:s.markerAt,label:a,fromCardinality:n,toCardinality:o}:null}(a);if(u){en(r,u.from),en(r,u.to),t.relationships.push(u);continue}}return t.classes=[...r.values()],t}function en(e,t){let r=e.get(t);return r||(r={id:t,label:t,attributes:[],methods:[]},e.set(t,r)),r}function ei(e){let t,r,n=e.trim().replace(/;$/,"");if(!n)return null;let i="",o=n;/^[+\-#~]/.test(o)&&(i=o[0],o=o.slice(1).trim());let l=o.match(/^(.+?)\(([^)]*)\)(?:\s*(.+))?$/);if(l){let e=l[1].trim(),t=l[3]?.trim(),r=e.endsWith("$")||o.includes("$"),n=e.endsWith("*")||o.includes("*");return{member:{visibility:i,name:e.replace(/[$*]$/,""),type:t||void 0,isStatic:r,isAbstract:n},isMethod:!0}}let a=o.split(/\s+/);a.length>=2?(r=a[0],t=a.slice(1).join(" ")):t=a[0]??o;let s=t.endsWith("$"),h=t.endsWith("*");return{member:{visibility:i,name:t.replace(/[$*]$/,""),type:r||void 0,isStatic:s,isAbstract:h},isMethod:!1}}function eo(e){let t=e.visibility||"",r=e.type?`: ${e.type}`:"";return`${t}${e.name}${r}`}function el(e,t,r){switch(e){case"inheritance":case"realization":if("down"===r)return t?"^":"";if("up"===r)return t?"v":"";if("left"===r)return t?">":"";else return t?"<":"";case"composition":return t?"*":"";case"aggregation":return t?"o":"";case"association":case"dependency":if("down"===r)return t?"v":"";if("up"===r)return t?"^":"";if("left"===r)return t?"<":"";else return t?">":""}}function ea(e){let t={entities:[],relationships:[]},r=new Map,n=null;for(let i=1;i<e.length;i++){let o=e[i];if(n){if("}"===o){n=null;continue}let e=function(e){let t,r=e.match(/^(\S+)\s+(\S+)(?:\s+(.+))?$/);if(!r)return null;let n=r[1],i=r[2],o=r[3]?.trim()??"",l=[],a=o.match(/"([^"]*)"/);for(let e of(a&&(t=a[1]),o.replace(/"[^"]*"/,"").trim().split(/\s+/))){let t=e.toUpperCase();("PK"===t||"FK"===t||"UK"===t)&&l.push(t)}return{type:n,name:i,keys:l,comment:t}}(o);e&&n.attributes.push(e);continue}let l=o.match(/^(\S+)\s*\{$/);if(l){n=es(r,l[1]);continue}let a=function(e){let t=e.match(/^(\S+)\s+([|o}{]+(?:--|\.\.)[|o}{]+)\s+(\S+)\s*:\s*(.+)$/);if(!t)return null;let r=t[1],n=t[2],i=t[3],o=t[4].trim(),l=n.match(/^([|o}{]+)(--|\.\.?)([|o}{]+)$/);if(!l)return null;let a=l[1],s=l[2],h=l[3],d=eh(a),f=eh(h);return d&&f?{entity1:r,entity2:i,cardinality1:d,cardinality2:f,label:o,identifying:"--"===s}:null}(o);if(a){es(r,a.entity1),es(r,a.entity2),t.relationships.push(a);continue}}return t.entities=[...r.values()],t}function es(e,t){let r=e.get(t);return r||(r={id:t,label:t,attributes:[]},e.set(t,r)),r}function eh(e){let t=e.split("").sort().join("");return"||"===t?"one":"o|"===t?"zero-one":"|}"===t||"{|"===t?"many":"{o"===t||"o{"===t?"zero-many":null}function ed(e){let t=e.keys.length>0?e.keys.join(",")+" ":"   ";return`${t}${e.type} ${e.name}`}function ef(e,t){if(t)switch(e){case"one":return"||";case"zero-one":return"o|";case"many":return"}|";case"zero-many":return"o{"}else switch(e){case"one":return"";case"zero-one":return"o";case"many":return"";case"zero-many":return"o"}}function ec(e,t={}){let r,n={useAscii:t.useAscii??!1,paddingX:t.paddingX??5,paddingY:t.paddingY??5,boxBorderPadding:t.boxBorderPadding??1,graphDirection:"TD"};switch(r=e.trim().split("\n")[0]?.trim().toLowerCase()??"",/^sequencediagram\s*$/.test(r)?"sequence":/^classdiagram\s*$/.test(r)?"class":/^erdiagram\s*$/.test(r)?"er":"flowchart"){case"sequence":return function(e,t){let r=ee(e.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("%%")));if(0===r.actors.length)return"";let n=t.useAscii,i=n?"-":"",o=n?"|":"",l=n?"+":"",a=n?"+":"",s=n?"+":"",h=n?"+":"",d=n?"+":"",f=n?"+":"",c=n?"+":"",u=n?"+":"",g=new Map;r.actors.forEach((e,t)=>g.set(e.id,t));let p=r.actors.map(e=>e.label.length+2+2).map(e=>Math.ceil(e/2)),m=Array(Math.max(r.actors.length-1,0)).fill(0);for(let e of r.messages){let t=g.get(e.from),r=g.get(e.to);if(t===r)continue;let n=Math.min(t,r),i=Math.max(t,r),o=Math.ceil((e.label.length+4)/(i-n));for(let e=n;e<i;e++)m[e]=Math.max(m[e],o)}let y=[p[0]];for(let e=1;e<r.actors.length;e++){let t=Math.max(p[e-1]+p[e]+2,m[e-1]+2,10);y[e]=y[e-1]+t}let x=[],w=[],b=new Map,v=new Map,$=new Map,k=[],M=3;for(let e=0;e<r.messages.length;e++){for(let t=0;t<r.blocks.length;t++)r.blocks[t].startIndex===e&&(M+=2,b.set(t,M-1));for(let t=0;t<r.blocks.length;t++)for(let n=0;n<r.blocks[t].dividers.length;n++)r.blocks[t].dividers[n].index===e&&(M+=1,$.set(`${t}:${n}`,M),M+=1);M+=1;let t=r.messages[e];t.from===t.to?(w[e]=M+1,x[e]=M,M+=3):(w[e]=M,x[e]=M+1,M+=2);for(let t=0;t<r.notes.length;t++)if(r.notes[t].afterIndex===e){let e;M+=1;let n=r.notes[t],i=n.text.split("\\n"),o=Math.max(...i.map(e=>e.length))+4,l=i.length+2,a=g.get(n.actorIds[0])??0;if("left"===n.position)e=y[a]-o-1;else if("right"===n.position)e=y[a]+2;else if(n.actorIds.length>=2){let t=g.get(n.actorIds[1])??a;e=Math.floor((y[a]+y[t])/2)-Math.floor(o/2)}else e=y[a]-Math.floor(o/2);e=Math.max(0,e),k.push({x:e,y:M,width:o,height:l,lines:i}),M+=l}for(let t=0;t<r.blocks.length;t++)r.blocks[t].endIndex===e&&(M+=1,v.set(t,M),M+=1)}let _=M+=1,E=_+3,j=(y[y.length-1]??0)+(p[p.length-1]??0)+2;for(let e=0;e<r.messages.length;e++){let t=r.messages[e];t.from===t.to&&(j=Math.max(j,y[g.get(t.from)]+6+2+t.label.length+1))}for(let e of k)j=Math.max(j,e.x+e.width+1);let C=N(j,E-1);function O(e,t,r){let n=r.length+2+2,d=e-Math.floor(n/2);C[d][t]=l;for(let e=1;e<n-1;e++)C[d+e][t]=i;C[d+n-1][t]=a,C[d][t+1]=o,C[d+n-1][t+1]=o;let f=d+1+1;for(let e=0;e<r.length;e++)C[f+e][t+1]=r[e];C[d][t+2]=s;for(let e=1;e<n-1;e++)C[d+e][t+2]=i;C[d+n-1][t+2]=h}for(let e=0;e<r.actors.length;e++){let t=y[e];for(let e=3;e<=_;e++)C[t][e]=o}for(let e=0;e<r.actors.length;e++){let t=r.actors[e];O(y[e],0,t.label),O(y[e],_,t.label),n||(C[y[e]][2]=d,C[y[e]][_]=f)}for(let e=0;e<r.messages.length;e++){let t=r.messages[e],l=g.get(t.from),a=g.get(t.to),s=y[l],h=y[a],d=l===a,f="dashed"===t.lineStyle,u="filled"===t.arrowHead,p=f?n?".":"":i;if(d){let r=x[e];C[s][r]=c;for(let e=s+1;e<s+4;e++)C[e][r]=p;C[s+4][r]=n?"+":"",C[s+4][r+1]=o;let i=s+4+2;for(let e=0;e<t.label.length;e++)i+e<j&&(C[i+e][r+1]=t.label[e]);let l=u?n?"<":"":n?"<":"";C[s][r+2]=l;for(let e=s+1;e<s+4;e++)C[e][r+2]=p;C[s+4][r+2]=n?"+":""}else{let r=w[e],i=x[e],o=s<h,l=Math.floor((s+h)/2)-Math.floor(t.label.length/2);for(let e=0;e<t.label.length;e++){let n=l+e;n>=0&&n<j&&(C[n][r]=t.label[e])}if(o){for(let e=s+1;e<h;e++)C[e][i]=p;let e=u?n?">":"":n?">":"";C[h][i]=e}else{for(let e=h+1;e<s;e++)C[e][i]=p;let e=u?n?"<":"":n?"<":"";C[h][i]=e}}}for(let e=0;e<r.blocks.length;e++){let t=r.blocks[e],d=b.get(e),f=v.get(e);if(void 0===d||void 0===f)continue;let p=j,m=0;for(let e=t.startIndex;e<=t.endIndex&&!(e>=r.messages.length);e++){let t=r.messages[e],n=g.get(t.from)??0,i=g.get(t.to)??0;p=Math.min(p,y[Math.min(n,i)]),m=Math.max(m,y[Math.max(n,i)])}let x=Math.max(0,p-4),w=Math.min(j-1,m+4);C[x][d]=l;for(let e=x+1;e<w;e++)C[e][d]=i;C[w][d]=a;let k=t.label?`${t.type} [${t.label}]`:t.type;for(let e=0;e<k.length&&x+1+e<w;e++)C[x+1+e][d]=k[e];C[x][f]=s;for(let e=x+1;e<w;e++)C[e][f]=i;C[w][f]=h;for(let e=d+1;e<f;e++)C[x][e]=o,C[w][e]=o;for(let r=0;r<t.dividers.length;r++){let i=$.get(`${e}:${r}`);if(void 0===i)continue;let o=n?"-":"";C[x][i]=c;for(let e=x+1;e<w;e++)C[e][i]=o;C[w][i]=u;let l=t.dividers[r].label;if(l){let e=`[${l}]`;for(let t=0;t<e.length&&x+1+t<w;t++)C[x+1+t][i]=e[t]}}}for(let e of k){D(C,e.x+e.width,e.y+e.height),C[e.x][e.y]=l;for(let t=1;t<e.width-1;t++)C[e.x+t][e.y]=i;C[e.x+e.width-1][e.y]=a;for(let t=0;t<e.lines.length;t++){let r=e.y+1+t;C[e.x][r]=o,C[e.x+e.width-1][r]=o;for(let n=0;n<e.lines[t].length;n++)C[e.x+2+n][r]=e.lines[t][n]}let t=e.y+e.height-1;C[e.x][t]=s;for(let r=1;r<e.width-1;r++)C[e.x+r][t]=i;C[e.x+e.width-1][t]=h}return X(C)}(e,n);case"class":return function(e,t){let r=er(e.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("%%")));if(0===r.classes.length)return"";let n=t.useAscii,i=new Map,o=new Map,l=new Map;for(let e of r.classes){let t=function(e){let t=[];e.annotation&&t.push(`<<${e.annotation}>>`),t.push(e.label);let r=e.attributes.map(eo),n=e.methods.map(eo);return 0===r.length&&0===n.length?[t]:0===n.length?[t,r]:[t,r,n]}(e);i.set(e.id,t);let r=0;for(let e of t)for(let t of e)r=Math.max(r,t.length);let n=r+4,a=0;for(let e of t)a+=Math.max(e.length,1);let s=a+(t.length-1)+2;o.set(e.id,n),l.set(e.id,s)}let a=new Map;for(let e of r.classes)a.set(e.id,e);let s=new Map,h=new Map;for(let e of r.relationships){let t="inheritance"===e.type||"realization"===e.type,r=t&&"to"===e.markerAt?e.to:e.from,n=t&&"to"===e.markerAt?e.from:e.to;s.has(n)||s.set(n,new Set),s.get(n).add(r),h.has(r)||h.set(r,new Set),h.get(r).add(n)}let d=new Map,f=r.classes.filter(e=>!s.has(e.id)||0===s.get(e.id).size).map(e=>e.id);for(let e of f)d.set(e,0);let c=r.classes.length-1,u=0;for(;u<f.length;){let e=f[u++],t=h.get(e);if(t)for(let r of t){let t=(d.get(e)??0)+1;!(t>c)&&(!d.has(r)||d.get(r)<t)&&(d.set(r,t),f.push(r))}}for(let e of r.classes)d.has(e.id)||d.set(e.id,0);let g=Math.max(...d.values(),0),p=Array.from({length:g+1},()=>[]);for(let e of r.classes)p[d.get(e.id)].push(e.id);let m=new Map,y=0;for(let e=0;e<=g;e++){let t=p[e];if(0===t.length)continue;let r=0,n=0;for(let e of t){let t=a.get(e),s=o.get(e),h=l.get(e);m.set(e,{cls:t,sections:i.get(e),x:r,y:y,width:s,height:h}),r+=s+4,n=Math.max(n,h)}y+=n+3}let x=0,w=0;for(let e of m.values())x=Math.max(x,e.x+e.width),w=Math.max(w,e.y+e.height);let b=N((x+=4)-1,(w+=2)-1);for(let e of m.values()){let t=U(e.sections,n);for(let r=0;r<t.length;r++)for(let n=0;n<t[0].length;n++){let i=t[r][n];if(" "!==i){let t=e.x+r,o=e.y+n;t<x&&o<w&&(b[t][o]=i)}}}let v=n?"-":"",$=n?"|":"",k=n?".":"",M=n?":":"";for(let e of r.relationships){var _;let t=m.get(e.from),r=m.get(e.to);if(!t||!r)continue;let i={type:_=e.type,markerAt:e.markerAt,dashed:"dependency"===_||"realization"===_},o=i.dashed?k:v,l=i.dashed?M:$,a=t.x+Math.floor(t.width/2),s=t.y+t.height-1,h=r.x+Math.floor(r.width/2),d=r.y;if(s<d){let e=s+Math.floor((d-s)/2);for(let t=s+1;t<=e;t++)t<w&&(b[a][t]=l);if(a!==h){let t=Math.min(a,h),r=Math.max(a,h);for(let n=t;n<=r;n++)n<x&&e<w&&(b[n][e]=o);!n&&e<w&&(a<h?(b[a][e]="",b[h][e]=""):(b[a][e]="",b[h][e]=""))}for(let t=e+1;t<d;t++)t<w&&(b[h][t]=l);if("to"===i.markerAt){let e=el(i.type,n,"down"),t=d-1;if(t>=0&&t<w)for(let r=0;r<e.length;r++){let n=h-Math.floor(e.length/2)+r;n>=0&&n<x&&(b[n][t]=e[r])}}if("from"===i.markerAt){let e=el(i.type,n,"down"),t=s+1;if(t<w)for(let r=0;r<e.length;r++){let n=a-Math.floor(e.length/2)+r;n>=0&&n<x&&(b[n][t]=e[r])}}}else if(r.y+r.height-1<t.y){let e=t.y,s=r.y+r.height-1,d=s+Math.floor((e-s)/2);for(let t=e-1;t>=d;t--)t>=0&&t<w&&(b[a][t]=l);if(a!==h){let e=Math.min(a,h),t=Math.max(a,h);for(let r=e;r<=t;r++)r<x&&d>=0&&d<w&&(b[r][d]=o);!n&&d>=0&&d<w&&(a<h?(b[a][d]="",b[h][d]=""):(b[a][d]="",b[h][d]=""))}for(let e=d-1;e>s;e--)e>=0&&e<w&&(b[h][e]=l);if("from"===i.markerAt){let t=el(i.type,n,"up"),r=e-1;if(r>=0&&r<w)for(let e=0;e<t.length;e++){let n=a-Math.floor(t.length/2)+e;n>=0&&n<x&&(b[n][r]=t[e])}}if("to"===i.markerAt){let e="inheritance"===i.type||"realization"===i.type?"down":"up",t=el(i.type,n,e),r=s+1;if(r<w)for(let e=0;e<t.length;e++){let n=h-Math.floor(t.length/2)+e;n>=0&&n<x&&(b[n][r]=t[e])}}}else{let e=Math.max(s,r.y+r.height-1)+2;D(b,x,e+1);for(let t=s+1;t<=e;t++)b[a][t]=l;let t=Math.min(a,h),d=Math.max(a,h);for(let r=t;r<=d;r++)b[r][e]=o;for(let t=e-1;t>=r.y+r.height;t--)b[h][t]=l;if("from"===i.markerAt){let e=el(i.type,n,"down"),t=s+1;if(t<w)for(let r=0;r<e.length;r++){let n=a-Math.floor(e.length/2)+r;n>=0&&n<x&&(b[n][t]=e[r])}}if("to"===i.markerAt){let e=el(i.type,n,"up"),t=r.y+r.height;if(t<w)for(let r=0;r<e.length;r++){let n=h-Math.floor(e.length/2)+r;n>=0&&n<x&&(b[n][t]=e[r])}}}if(e.label){let n,i=` ${e.label} `,o=Math.floor((a+h)/2);n=s<d?Math.floor((s+1+d-1)/2):r.y+r.height-1<t.y?Math.floor((r.y+r.height-1+1+t.y-1)/2):Math.max(s,r.y+r.height-1)+2;let l=o-Math.floor(i.length/2);for(let e=0;e<i.length;e++){let t=l+e;t>=0&&t<x&&n>=0&&n<w&&(b[t][n]=i[e])}}}return X(b)}(e,n);case"er":return function(e,t){let r=ea(e.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("%%")));if(0===r.entities.length)return"";let n=t.useAscii,i=new Map,o=new Map,l=new Map;for(let e of r.entities){let t=function(e){let t=[e.label],r=e.attributes.map(ed);return 0===r.length?[t]:[t,r]}(e);i.set(e.id,t);let r=0;for(let e of t)for(let t of e)r=Math.max(r,t.length);let n=r+4,a=0;for(let e of t)a+=Math.max(e.length,1);let s=a+(t.length-1)+2;o.set(e.id,n),l.set(e.id,s)}let a=Math.max(2,Math.ceil(Math.sqrt(r.entities.length))),s=new Map,h=0,d=0,f=0,c=0;for(let e of r.entities){let t=o.get(e.id),r=l.get(e.id);c>=a&&(d+=f+4,h=0,f=0,c=0),s.set(e.id,{entity:e,sections:i.get(e.id),x:h,y:d,width:t,height:r}),h+=t+6,f=Math.max(f,r),c++}let u=0,g=0;for(let e of s.values())u=Math.max(u,e.x+e.width),g=Math.max(g,e.y+e.height);let p=N((u+=4)-1,(g+=2)-1);for(let e of s.values()){let t=U(e.sections,n);for(let r=0;r<t.length;r++)for(let n=0;n<t[0].length;n++){let i=t[r][n];if(" "!==i){let t=e.x+r,o=e.y+n;t<u&&o<g&&(p[t][o]=i)}}}let m=n?"-":"",y=n?"|":"",x=n?".":"",w=n?":":"";for(let e of r.relationships){let t=s.get(e.entity1),r=s.get(e.entity2);if(!t||!r)continue;let i=e.identifying?m:x,o=e.identifying?y:w,l=t.x+Math.floor(t.width/2),a=t.y+Math.floor(t.height/2),h=r.x+Math.floor(r.width/2),d=r.y+Math.floor(r.height/2);if(Math.abs(a-d)<Math.max(t.height,r.height)){let[o,a]=l<h?[t,r]:[r,t],[s,d]=l<h?[e.cardinality1,e.cardinality2]:[e.cardinality2,e.cardinality1],f=o.x+o.width,c=a.x-1,g=o.y+Math.floor(o.height/2);for(let e=f;e<=c;e++)e<u&&(p[e][g]=i);let m=ef(s,n);for(let e=0;e<m.length;e++){let t=f+e;t<u&&(p[t][g]=m[e])}let y=ef(d,n);for(let e=0;e<y.length;e++){let t=c-y.length+1+e;t>=0&&t<u&&(p[t][g]=y[e])}if(e.label){let t=Math.floor((f+c)/2),r=Math.max(f,t-Math.floor(e.label.length/2)),n=g-1;if(n>=0)for(let t=0;t<e.label.length;t++){let i=r+t;i>=f&&i<=c&&i<u&&(p[i][n]=e.label[t])}}}else{let[l,s]=a<d?[t,r]:[r,t],[h,f]=a<d?[e.cardinality1,e.cardinality2]:[e.cardinality2,e.cardinality1],c=l.y+l.height,m=s.y-1,y=l.x+Math.floor(l.width/2);for(let e=c;e<=m;e++)e<g&&(p[y][e]=o);let x=s.x+Math.floor(s.width/2);if(y!==x){let e=Math.floor((c+m)/2),t=Math.min(y,x),r=Math.max(y,x);for(let n=t;n<=r;n++)n<u&&e<g&&(p[n][e]=i);for(let t=e+1;t<=m;t++)t<g&&(p[x][t]=o)}let w=ef(h,n);if(c<g)for(let e=0;e<w.length;e++){let t=y-Math.floor(w.length/2)+e;t>=0&&t<u&&(p[t][c]=w[e])}let b=y!==x?x:y,v=ef(f,n);if(m>=0&&m<g)for(let e=0;e<v.length;e++){let t=b-Math.floor(v.length/2)+e;t>=0&&t<u&&(p[t][m]=v[e])}if(e.label){let t=Math.floor((c+m)/2),r=y+2;if(t>=0)for(let n=0;n<e.label.length;n++){let i=r+n;i>=0&&(D(p,i+1,t+1),p[i][t]=e.label[n])}}}}return X(p)}(e,n);default:{let t=a(e);"LR"===t.direction||"RL"===t.direction?n.graphDirection="LR":n.graphDirection="TD";let r=function(e,t){let r=new Map,n=0;for(let[t,i]of e.nodes){let e={name:t,displayLabel:i.label,index:n,gridCoord:null,drawingCoord:null,drawing:null,drawn:!1,styleClassName:"",styleClass:S};r.set(t,e),n++}let i=[...r.values()],o=[];for(let t of e.edges){let e=r.get(t.source),n=r.get(t.target);e&&n&&o.push({from:e,to:n,text:t.label??"",path:[],labelLine:[],startDir:{x:0,y:0},endDir:{x:0,y:0}})}let l=[];for(let t of e.subgraphs)!function e(t,r,n,i){let o={name:t.label,nodes:[],parent:r,children:[],minX:0,minY:0,maxX:0,maxY:0};for(let e of t.nodeIds){let t=n.get(e);t&&o.nodes.push(t)}for(let r of(i.push(o),t.children)){let t=e(r,o,n,i);for(let e of(o.children.push(t),t.nodes))o.nodes.includes(e)||o.nodes.push(e)}return o}(t,null,r,l);for(let[t,n]of(function(e,t,r,n){let i=new Map;var o=e,l=t,a=i;let s=[];!function e(t){for(let r of t)s.push(r),e(r.children)}(o);for(let e=0;e<s.length&&e<l.length;e++)a.set(s[e],l[e]);let h=new Map;for(let t of e)!function e(t){let r=i.get(t);if(r){for(let r of t.children)e(r);for(let e of t.nodeIds)h.has(e)||h.set(e,r)}}(t);for(let e of t)e.nodes=e.nodes.filter(t=>{let n;for(let[e,i]of r)if(i===t){n=e;break}if(!n)return!1;let i=h.get(n);return!i||function(e,t){let r=t;for(;null!==r;){if(r===e)return!0;r=r.parent}return!1}(e,i)})}(e.subgraphs,l,r),e.classAssignments)){let i=r.get(t),o=e.classDefs.get(n);i&&o&&(i.styleClassName=n,i.styleClass={name:n,styles:o})}return{nodes:i,edges:o,canvas:N(0,0),grid:new Map,columnWidth:new Map,rowHeight:new Map,subgraphs:l,config:t,offsetX:0,offsetY:0}}(t,n);return!function(e){let t,r=e.config.graphDirection,n=Array(100).fill(0),i=new Set,o=[];for(let t of e.nodes)for(let r of(i.has(t.name)||o.push(t),i.add(t.name),Q(e,t)))i.add(r.name);let l=!1,a=!1;for(let t of o)J(e,t)?Q(e,t).length>0&&(a=!0):l=!0;let s="LR"===r&&l&&a,h=[];for(let i of(s?(t=o.filter(t=>!J(e,t)),h=o.filter(t=>J(e,t))):t=o,t)){let t="LR"===r?{x:0,y:n[0]}:{x:n[0],y:0};K(e,e.nodes[i.index],t),n[0]=n[0]+4}if(s&&h.length>0)for(let t of h){let i="LR"===r?{x:4,y:n[4]}:{x:n[4],y:4};K(e,e.nodes[t.index],i),n[4]=n[4]+4}for(let t of e.nodes){let i=t.gridCoord,o="LR"===r?i.x+4:i.y+4,l=n[o];for(let i of Q(e,t)){if(null!==i.gridCoord)continue;let t="LR"===r?{x:o,y:l}:{x:l,y:o};K(e,e.nodes[i.index],t),n[o]=l+4,l=n[o]}}for(let t of e.nodes)!function(e,t){let r=t.gridCoord,n=e.config.boxBorderPadding,i=[1,2*n+t.displayLabel.length,1],o=[1,1+2*n,1];for(let t=0;t<i.length;t++){let n=r.x+t,o=e.columnWidth.get(n)??0;e.columnWidth.set(n,Math.max(o,i[t]))}for(let t=0;t<o.length;t++){let n=r.y+t,i=e.rowHeight.get(n)??0;e.rowHeight.set(n,Math.max(i,o[t]))}if(r.x>0){let t=e.columnWidth.get(r.x-1)??0;e.columnWidth.set(r.x-1,Math.max(t,e.config.paddingX))}if(r.y>0){let n=e.config.paddingY;(function(e,t){let r=Z(e,t);if(!r)return!1;let n=!1;for(let i of e.edges)if(i.to===t&&Z(e,i.from)!==r){n=!0;break}if(!n)return!1;for(let n of r.nodes){if(n===t||!n.gridCoord)continue;let i=!1;for(let t of e.edges)if(t.to===n&&Z(e,t.from)!==r){i=!0;break}if(i&&n.gridCoord.y<t.gridCoord.y)return!1}return!0})(e,t)&&(n+=4);let i=e.rowHeight.get(r.y-1)??0;e.rowHeight.set(r.y-1,Math.max(i,n))}}(e,t);for(let t of e.edges){for(let r of(!function(e,t){let[r,n,i,o]=function(e,t){let r,n,i,o;if(e.from===e.to)return"LR"===t?[$,b,b,$]:[b,$,$,b];let l=F(e.from.gridCoord,e.to.gridCoord),a="LR"===t?H(l,v)||H(l,M)||H(l,E):H(l,w)||H(l,M)||H(l,k);return H(l,_)?"LR"===t?(r=b,n=v,i=$,o=w):(r=$,n=w,i=b,o=v):H(l,k)?"LR"===t?(r=w,n=v,i=$,o=b):(r=$,n=b,i=w,o=v):H(l,E)?"LR"===t?(r=b,n=b,i=v,o=w):(r=v,n=w,i=b,o=$):H(l,M)?"LR"===t?(r=b,n=b,i=v,o=b):(r=$,n=$,i=w,o=$):a?"LR"===t&&H(l,v)?(r=b,n=b,i=v,o=$):"TD"===t&&H(l,w)?(r=$,n=$,i=w,o=b):(r=l,n=q(l),i=l,o=q(l)):(r=l,n=q(l),i=l,o=q(l)),[r,n,i,o]}(t,e.config.graphDirection),l=O(t.from.gridCoord,r),a=O(t.to.gridCoord,n),s=P(e.grid,l,a);if(null===s){t.startDir=i,t.endDir=o,t.path=[];return}s=G(s);let h=O(t.from.gridCoord,i),d=O(t.to.gridCoord,o),f=P(e.grid,h,d);if(null===f){t.startDir=r,t.endDir=n,t.path=s;return}f=G(f),s.length<=f.length?(t.startDir=r,t.endDir=n,t.path=s):(t.startDir=i,t.endDir=o,t.path=f)}(e,t),t.path))e.columnWidth.has(r.x)||e.columnWidth.set(r.x,Math.floor(e.config.paddingX/2)),e.rowHeight.has(r.y)||e.rowHeight.set(r.y,Math.floor(e.config.paddingY/2));!function(e,t){if(0===t.text.length)return;let r=t.text.length,n=t.path[0],i=[n,t.path[1]],o=0;for(let l=1;l<t.path.length;l++){let a=t.path[l],s=[n,a],h=function(e,t){let r=0,n=Math.min(t[0].x,t[1].x),i=Math.max(t[0].x,t[1].x);for(let t=n;t<=i;t++)r+=e.columnWidth.get(t)??0;return r}(e,s);if(h>=r){i=s;break}h>o&&(o=h,i=s),n=a}let l=Math.min(i[0].x,i[1].x),a=l+Math.floor((Math.max(i[0].x,i[1].x)-l)/2),s=e.columnWidth.get(a)??0;e.columnWidth.set(a,Math.max(s,r+2)),t.labelLine=[i[0],i[1]]}(e,t)}for(let t of e.nodes)t.drawingCoord=V(e,t.gridCoord),t.drawing=function(e,t){let r=e.gridCoord,n=t.config.useAscii,i=0;for(let e=0;e<2;e++)i+=t.columnWidth.get(r.x+e)??0;let o=0;for(let e=0;e<2;e++)o+=t.rowHeight.get(r.y+e)??0;let l=i,a=o,s=N(Math.max(0,l),Math.max(0,a));if(n){for(let e=1;e<l;e++)s[e][0]="-";for(let e=1;e<l;e++)s[e][a]="-";for(let e=1;e<a;e++)s[0][e]="|";for(let e=1;e<a;e++)s[l][e]="|";s[0][0]="+",s[l][0]="+",s[0][a]="+",s[l][a]="+"}else{for(let e=1;e<l;e++)s[e][0]="";for(let e=1;e<l;e++)s[e][a]="";for(let e=1;e<a;e++)s[0][e]="";for(let e=1;e<a;e++)s[l][e]="";s[0][0]="",s[l][0]="",s[0][a]="",s[l][a]=""}let h=e.displayLabel,d=0+Math.floor(o/2),f=0+Math.floor(i/2)-Math.ceil(h.length/2)+1;for(let e=0;e<h.length;e++)s[f+e][d]=h[e];return s}(t,e);!function(e,t,r){let n=0,i=0;for(let e of t.values())n+=e;for(let e of r.values())i+=e;D(e,n-1,i-1)}(e.canvas,e.columnWidth,e.rowHeight);for(let t of e.subgraphs)!function e(t,r){if(0===r.nodes.length)return;let n=1e6,i=1e6,o=-1e6,l=-1e6;for(let a of r.children)e(t,a),a.nodes.length>0&&(n=Math.min(n,a.minX),i=Math.min(i,a.minY),o=Math.max(o,a.maxX),l=Math.max(l,a.maxY));for(let e of r.nodes){if(!e.drawingCoord||!e.drawing)continue;let t=e.drawingCoord.x,r=e.drawingCoord.y,a=t+e.drawing.length-1,s=r+e.drawing[0].length-1;n=Math.min(n,t),i=Math.min(i,r),o=Math.max(o,a),l=Math.max(l,s)}r.minX=n-2,r.minY=i-2-2,r.maxX=o+2,r.maxY=l+2}(e,t);!function(e){let t=e.subgraphs.filter(e=>null===e.parent&&e.nodes.length>0);for(let e=0;e<t.length;e++)for(let r=e+1;r<t.length;r++){let n=t[e],i=t[r];n.minX<i.maxX&&n.maxX>i.minX&&(n.maxY>=i.minY-1&&n.minY<i.minY?i.minY=n.maxY+1+1:i.maxY>=n.minY-1&&i.minY<n.minY&&(n.minY=i.maxY+1+1)),n.minY<i.maxY&&n.maxY>i.minY&&(n.maxX>=i.minX-1&&n.minX<i.minX?i.minX=n.maxX+1+1:i.maxX>=n.minX-1&&i.minX<n.minX&&(n.minX=i.maxX+1+1))}}(e),function(e){if(0===e.subgraphs.length)return;let t=0,r=0;for(let n of e.subgraphs)t=Math.min(t,n.minX),r=Math.min(r,n.minY);let n=-t,i=-r;if(0!==n||0!==i){for(let t of(e.offsetX=n,e.offsetY=i,e.subgraphs))t.minX+=n,t.minY+=i,t.maxX+=n,t.maxY+=i;for(let t of e.nodes)t.drawingCoord&&(t.drawingCoord.x+=n,t.drawingCoord.y+=i)}}(e)}(r),!function(e){let t=e.config.useAscii;for(let r of function(e){function t(e){return null===e.parent?0:1+t(e.parent)}let r=[...e];return r.sort((e,r)=>t(e)-t(r)),r}(e.subgraphs)){let n=function(e,t){let r=e.maxX-e.minX,n=e.maxY-e.minY;if(r<=0||n<=0)return N(0,0);let i=N(r,n);if(t.config.useAscii){for(let e=1;e<r;e++)i[e][0]="-";for(let e=1;e<r;e++)i[e][n]="-";for(let e=1;e<n;e++)i[0][e]="|";for(let e=1;e<n;e++)i[r][e]="|";i[0][0]="+",i[r][0]="+",i[0][n]="+",i[r][n]="+"}else{for(let e=1;e<r;e++)i[e][0]="";for(let e=1;e<r;e++)i[e][n]="";for(let e=1;e<n;e++)i[0][e]="";for(let e=1;e<n;e++)i[r][e]="";i[0][0]="",i[r][0]="",i[0][n]="",i[r][n]=""}return i}(r,e),i={x:r.minX,y:r.minY};e.canvas=Y(e.canvas,i,t,n)}for(let r of e.nodes)!r.drawn&&r.drawingCoord&&r.drawing&&(e.canvas=Y(e.canvas,r.drawingCoord,t,r.drawing),r.drawn=!0);let r=[],n=[],i=[],o=[],l=[];for(let t of e.edges){let[a,s,h,d,f]=function(e,t){if(0===t.path.length){let t=A(e.canvas);return[t,t,t,t,t]}let r=function(e,t){let r=A(e.canvas);return 0===t.text.length||function(e,t,r){if(t.length<2)return;let n=Math.min(t[0].x,t[1].x),i=Math.max(t[0].x,t[1].x),o=Math.min(t[0].y,t[1].y),l=o+Math.floor((Math.max(t[0].y,t[1].y)-o)/2);var a=n+Math.floor((i-n)/2)-Math.floor(r.length/2),s=l;D(e,a+r.length,s);for(let t=0;t<r.length;t++)e[a+t][s]=r[t]}(r,function(e,t){return t.map(t=>V(e,t))}(e,t.labelLine),t.text),r}(e,t),[n,i,o]=function(e,t){let r=A(e.canvas),n=t[0],i=[],o=[];for(let l=1;l<t.length;l++){let a=t[l],s=V(e,n),h=V(e,a);if(s.x===h.x&&s.y===h.y){n=a;continue}let d=F(n,a),f=function(e,t,r,n,i,o){let l=F(t,r),a=[],s=o?"-":"",h=o?"|":"",d=o?"\\":"",f=o?"/":"";if(H(l,w))for(let n=t.y-1;n>=r.y- -1;n--)a.push({x:t.x,y:n}),e[t.x][n]=h;else if(H(l,b))for(let n=t.y+1;n<=r.y+-1;n++)a.push({x:t.x,y:n}),e[t.x][n]=h;else if(H(l,v))for(let n=t.x-1;n>=r.x- -1;n--)a.push({x:n,y:t.y}),e[n][t.y]=s;else if(H(l,$))for(let n=t.x+1;n<=r.x+-1;n++)a.push({x:n,y:t.y}),e[n][t.y]=s;else if(H(l,M))for(let n=t.x,i=t.y-1;n>=r.x- -1&&i>=r.y- -1;n--,i--)a.push({x:n,y:i}),e[n][i]=d;else if(H(l,k))for(let n=t.x,i=t.y-1;n<=r.x+-1&&i>=r.y- -1;n++,i--)a.push({x:n,y:i}),e[n][i]=f;else if(H(l,E))for(let n=t.x,i=t.y+1;n>=r.x- -1&&i<=r.y+-1;n--,i++)a.push({x:n,y:i}),e[n][i]=f;else if(H(l,_))for(let n=t.x,i=t.y+1;n<=r.x+-1&&i<=r.y+-1;n++,i++)a.push({x:n,y:i}),e[n][i]=d;return a}(r,s,h,0,0,e.config.useAscii);0===f.length&&f.push(s),i.push(f),o.push(d),n=a}return[r,i,o]}(e,t.path);return[n,function(e,t,r){let n=A(e.canvas);if(e.config.useAscii)return n;let i=r[0],o=F(t[0],t[1]);return H(o,w)?n[i.x][i.y+1]="":H(o,b)?n[i.x][i.y-1]="":H(o,v)?n[i.x+1][i.y]="":H(o,$)&&(n[i.x-1][i.y]=""),n}(e,t.path,i[0]),function(e,t,r){let n,i=A(e.canvas);if(0===t.length)return i;let o=t[0],l=t[t.length-1],a=F(o,l);return(1===t.length||H(a,j))&&(a=r),n=e.config.useAscii?H(a,w)?"^":H(a,b)?"v":H(a,v)?"<":H(a,$)?">":H(r,w)?"^":H(r,b)?"v":H(r,v)?"<":H(r,$)?">":"*":H(a,w)?"":H(a,b)?"":H(a,v)?"":H(a,$)?"":H(a,k)?"":H(a,M)?"":H(a,_)?"":H(a,E)?"":H(r,w)?"":H(r,b)?"":H(r,v)?"":H(r,$)?"":H(r,k)?"":H(r,M)?"":H(r,_)?"":H(r,E)?"":"",i[l.x][l.y]=n,i}(e,i[i.length-1],o[o.length-1]),function(e,t){let r=A(e.canvas);for(let n=1;n<t.length-1;n++){let i,o=t[n],l=V(e,o),a=F(t[n-1],o),s=F(o,t[n+1]);i=e.config.useAscii?"+":H(a,$)&&H(s,b)||H(a,w)&&H(s,v)?"":H(a,$)&&H(s,w)||H(a,b)&&H(s,v)?"":H(a,v)&&H(s,b)||H(a,w)&&H(s,$)?"":H(a,v)&&H(s,w)||H(a,b)&&H(s,$)?"":"+",r[l.x][l.y]=i}return r}(e,t.path),r]}(e,t);r.push(a),n.push(d),i.push(h),o.push(s),l.push(f)}let a={x:0,y:0};for(let s of(e.canvas=Y(e.canvas,a,t,...r),e.canvas=Y(e.canvas,a,t,...n),e.canvas=Y(e.canvas,a,t,...i),e.canvas=Y(e.canvas,a,t,...o),e.canvas=Y(e.canvas,a,t,...l),e.subgraphs)){if(0===s.nodes.length)continue;let[r,n]=function(e,t){let r=e.maxX-e.minX,n=e.maxY-e.minY;if(r<=0||n<=0)return[N(0,0),{x:0,y:0}];let i=N(r,n),o=Math.floor(r/2)-Math.floor(e.name.length/2);o<1&&(o=1);for(let t=0;t<e.name.length;t++)o+t<r&&(i[o+t][1]=e.name[t]);return[i,{x:e.minX,y:e.minY}]}(s);e.canvas=Y(e.canvas,n,t,r)}e.canvas}(r),"BT"===t.direction&&function(e){for(let t of e)t.reverse();for(let t of e)for(let e=0;e<t.length;e++){let r=W[t[e]];r&&(t[e]=r)}}(r.canvas),X(r.canvas)}}}function eu(e,t,r){return e.length*t*(r>=600?.58:r>=500?.55:.52)}function eg(e,t){return e.length*t*.6}var ep="0.35em";function em(e,t,r,n){return{x:e-r/2,y:t-n/2}}function ey(e,t,r,n,i){let o=e.x-t,l=e.y-r;if(.5>Math.abs(o)&&.5>Math.abs(l))return e;let a=1/(Math.abs(o)/n+Math.abs(l)/i);return{x:t+a*o,y:r+a*l}}function ex(e,t,r,n){let i=e.x-t,o=e.y-r,l=Math.sqrt(i*i+o*o);if(l<.5)return e;let a=n/l;return{x:t+a*i,y:r+a*o}}function ew(e,t=!0){if(e.length<2)return e;let r=[e[0]];for(let n=1;n<e.length;n++){let i=r[r.length-1],o=e[n],l=Math.abs(o.x-i.x),a=Math.abs(o.y-i.y);if(l<1||a<1){r.push(o);continue}t?r.push({x:i.x,y:o.y}):r.push({x:o.x,y:i.y}),r.push(o)}return function(e){if(e.length<3)return e;let t=[e[0]];for(let r=1;r<e.length-1;r++){let n=t[t.length-1],i=e[r],o=e[r+1],l=1>Math.abs(n.x-i.x)&&1>Math.abs(i.x-o.x),a=1>Math.abs(n.y-i.y)&&1>Math.abs(i.y-o.y);l||a||t.push(i)}return t.push(e[e.length-1]),t}(r)}function eb(e,t,r){if(e.length<2)return e;let n=e.map(e=>({...e}));if(r){let t=n.length-1;if(2===e.length){let e=n[0],i=n[t],o=Math.abs(i.x-e.x);if(Math.abs(i.y-e.y)>=o){let o=i.y>e.y?r.cy-r.hh:r.cy+r.hh;n[t]={x:i.x,y:o}}else{let o=i.x>e.x?r.cx-r.hw:r.cx+r.hw;n[t]={x:o,y:i.y}}}else{let e=n[t-1],i=n[t],o=Math.abs(i.x-e.x),l=Math.abs(i.y-e.y),a=l<1&&o>=1,s=o<1&&l>=1;if(a){let o=i.x>e.x?r.cx-r.hw:r.cx+r.hw;n[t]={x:o,y:r.cy},n[t-1]={...e,y:r.cy}}else if(s){let o=i.y>e.y?r.cy-r.hh:r.cy+r.hh;n[t]={x:r.cx,y:o},n[t-1]={...e,x:r.cx}}else if(a||s||!(l<o)){if(!a&&!s&&o<l){let o=i.y>e.y?r.cy-r.hh:r.cy+r.hh;e.x>=r.cx-r.hw&&e.x<=r.cx+r.hw?n[t]={x:e.x,y:o}:(n[t]={x:r.cx,y:o},n[t-1]={...e,x:r.cx})}}else{let o=i.x>e.x?r.cx-r.hw:r.cx+r.hw;e.y>=r.cy-r.hh&&e.y<=r.cy+r.hh?n[t]={x:o,y:e.y}:(n[t]={x:o,y:r.cy},n[t-1]={...e,y:r.cy})}}}if(t&&e.length>=3){let e=n[0],r=n[1],i=Math.abs(r.x-e.x),o=Math.abs(r.y-e.y),l=o<1&&i>=1,a=i<1&&o>=1;if(l){let i=r.x>e.x?t.cx+t.hw:t.cx-t.hw;n[0]={x:i,y:t.cy},n[1]={...n[1],y:t.cy}}else if(a){let i=r.y>e.y?t.cy+t.hh:t.cy-t.hh;n[0]={x:t.cx,y:i},n[1]={...n[1],x:t.cx}}else if(l||a||!(o<i)){if(!l&&!a&&i<o){let i=r.y>e.y?t.cy+t.hh:t.cy-t.hh;r.x>=t.cx-t.hw&&r.x<=t.cx+t.hw?n[0]={x:r.x,y:i}:(n[0]={x:t.cx,y:i},n[1]={...n[1],x:t.cx})}}else{let i=r.x>e.x?t.cx+t.hw:t.cx-t.hw;r.y>=t.cy-t.hh&&r.y<=t.cy+t.hh?n[0]={x:i,y:r.y}:(n[0]={x:i,y:t.cy},n[1]={...n[1],y:t.cy})}}return n}var ev=new Set(["circle","doublecircle","state-start","state-end"]),e$=new Set(["diamond","circle","doublecircle","state-start","state-end"]),ek={font:"Inter",padding:40,nodeSpacing:24,layerSpacing:40};async function eM(e,r={}){let n={...ek,...r},i=new Map;for(let r of e.subgraphs)r.direction&&r.direction!==e.direction&&i.set(r.id,function(e,r,n){let i=new t.default.graphlib.Graph({directed:!0,compound:!0});i.setGraph({rankdir:e_(e.direction),acyclicer:"greedy",nodesep:n.nodeSpacing,ranksep:n.layerSpacing,marginx:16,marginy:12}),i.setDefaultEdgeLabel(()=>({}));let o=new Set;for(let t of(o.add(e.id),eO(e,o),e.nodeIds)){let e=r.nodes.get(t);if(e){let r=eE(t,e.label,e.shape);i.setNode(t,{label:e.label,width:r.width,height:r.height})}}for(let t of e.children)ej(i,t,r);let l=new Set;for(let e=0;e<r.edges.length;e++){let t=r.edges[e];if(o.has(t.source)&&o.has(t.target)){l.add(e);let r={_index:e};t.label&&(r.label=t.label,r.width=eu(t.label,11,400)+8,r.height=17,r.labelpos="c"),i.setEdge(t.source,t.target,r)}}t.default.layout(i);let a="TD"===e.direction||"TB"===e.direction||"BT"===e.direction,s=new Set;for(let t of e.children)eS(t,s);let h=[];for(let e of i.nodes()){if(s.has(e))continue;let t=r.nodes.get(e);if(!t)continue;let n=i.node(e);if(!n)continue;let o=em(n.x,n.y,n.width,n.height);h.push({id:e,label:t.label,shape:t.shape,x:o.x,y:o.y,width:n.width,height:n.height,inlineStyle:eC(r,e)})}let d=i.edges().map(e=>{let t,n,o,l=i.edge(e),s=r.edges[l._index],h=l.points??[];if(h.length>0){let t=r.nodes.get(e.v)?.shape;if("diamond"===t){let t=i.node(e.v);h[0]=ey(h[0],t.x,t.y,t.width/2,t.height/2)}else if(t&&ev.has(t)){let t=i.node(e.v);h[0]=ex(h[0],t.x,t.y,Math.min(t.width,t.height)/2)}let n=r.nodes.get(e.w)?.shape;if("diamond"===n){let t=i.node(e.w),r=h.length-1;h[r]=ey(h[r],t.x,t.y,t.width/2,t.height/2)}else if(n&&ev.has(n)){let t=i.node(e.w),r=h.length-1;h[r]=ex(h[r],t.x,t.y,Math.min(t.width,t.height)/2)}}let d=ew(h,a),f=r.nodes.get(e.v)?.shape,c=r.nodes.get(e.w)?.shape,u=eb(d,(!f||e$.has(f))&&f?null:(n=i.node(e.v))?{cx:n.x,cy:n.y,hw:n.width/2,hh:n.height/2}:null,(!c||e$.has(c))&&c?null:(o=i.node(e.w))?{cx:o.x,cy:o.y,hw:o.width/2,hh:o.height/2}:null);return s.label&&null!=l.x&&null!=l.y&&(t={x:l.x,y:l.y}),{source:s.source,target:s.target,label:s.label,style:s.style,hasArrowStart:s.hasArrowStart,hasArrowEnd:s.hasArrowEnd,points:u,labelPosition:t}}),f=e.children.map(e=>eL(i,e)),c=i.graph();return{id:e.id,label:e.label,width:c.width??200,height:c.height??100,nodes:h,edges:d,groups:f,nodeIds:o,internalEdgeIndices:l}}(r,e,n));let o=new t.default.graphlib.Graph({directed:!0,compound:!0});o.setGraph({rankdir:e_(e.direction),acyclicer:"greedy",nodesep:n.nodeSpacing,ranksep:n.layerSpacing,marginx:n.padding,marginy:n.padding}),o.setDefaultEdgeLabel(()=>({}));let l=new Set;for(let t of e.subgraphs)l.add(t.id),eO(t,l);for(let[t,r]of e.nodes)if(!l.has(t)){let e=eE(t,r.label,r.shape);o.setNode(t,{label:r.label,width:e.width,height:e.height})}for(let t of e.subgraphs)if(i.has(t.id)){let e=i.get(t.id);o.setNode(t.id,{width:e.width,height:e.height})}else ej(o,t,e);let a=new Map,s=new Map;for(let t of e.subgraphs)i.has(t.id)||function e(t,r,n){for(let i of t.children)e(i,r,n);let i=[...t.nodeIds,...t.children.map(e=>e.id)];if(0===i.length){r.set(t.id,t.id),n.set(t.id,t.id);return}let o=i[0],l=i[i.length-1];r.set(t.id,r.get(o)??o),n.set(t.id,n.get(l)??l)}(t,a,s);for(let[e,t]of i)for(let r of t.nodeIds)a.set(r,e),s.set(r,e);let h=new Set;for(let e of i.values())for(let t of e.internalEdgeIndices)h.add(t);let d=new Set;for(let t=0;t<e.edges.length;t++){if(h.has(t))continue;let r=e.edges[t],n=s.get(r.source)??r.source,i=a.get(r.target)??r.target,l={_index:t};r.label&&(l.label=r.label,l.width=eu(r.label,11,400)+8,l.height=17,l.labelpos="c"),d.has(i)||(l.weight=2,d.add(i)),o.setEdge(n,i,l)}try{t.default.layout(o)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error(`Dagre layout failed: ${e}`)}return function(e,t,r,n){let i=[],o=[],l=new Set;for(let e of t.subgraphs)eS(e,l);let a=new Set;if(n)for(let e of n.values())for(let t of e.nodeIds)a.add(t);for(let r of e.nodes()){if(l.has(r))continue;let n=t.nodes.get(r);if(!n)continue;let o=e.node(r);if(!o)continue;let a=em(o.x,o.y,o.width,o.height);i.push({id:r,label:n.label,shape:n.shape,x:a.x,y:a.y,width:o.width,height:o.height,inlineStyle:eC(t,r)})}for(let r of t.subgraphs)o.push(eL(e,r));let s="TD"===t.direction||"TB"===t.direction||"BT"===t.direction,h=e.edges().map(r=>{let n,i,o,l=e.edge(r),a=t.edges[l._index],h=l.points??[];if(h.length>0){let n=t.nodes.get(r.v)?.shape;if("diamond"===n){let t=e.node(r.v);h[0]=ey(h[0],t.x,t.y,t.width/2,t.height/2)}else if(n&&ev.has(n)){let t=e.node(r.v);h[0]=ex(h[0],t.x,t.y,Math.min(t.width,t.height)/2)}let i=t.nodes.get(r.w)?.shape;if("diamond"===i){let t=e.node(r.w),n=h.length-1;h[n]=ey(h[n],t.x,t.y,t.width/2,t.height/2)}else if(i&&ev.has(i)){let t=e.node(r.w),n=h.length-1;h[n]=ex(h[n],t.x,t.y,Math.min(t.width,t.height)/2)}}let d=ew(h,s),f=t.nodes.get(r.v)?.shape,c=t.nodes.get(r.w)?.shape,u=eb(d,(!f||e$.has(f))&&f?null:(i=e.node(r.v))?{cx:i.x,cy:i.y,hw:i.width/2,hh:i.height/2}:null,(!c||e$.has(c))&&c?null:(o=e.node(r.w))?{cx:o.x,cy:o.y,hw:o.width/2,hh:o.height/2}:null);return a.label&&null!=l.x&&null!=l.y&&(n={x:l.x,y:l.y}),{source:a.source,target:a.target,label:a.label,style:a.style,hasArrowStart:a.hasArrowStart,hasArrowEnd:a.hasArrowEnd,points:u,labelPosition:n}});if(n&&n.size>0){let t=new Map;for(let e of i)t.set(e.id,{cx:e.x+e.width/2,cy:e.y+e.height/2});for(let[r,l]of n){let n=e.node(r);if(!n)continue;let a=em(n.x,n.y,n.width,n.height);for(let e of l.nodes){let r={...e,x:e.x+a.x,y:e.y+a.y};i.push(r),t.set(r.id,{cx:r.x+r.width/2,cy:r.y+r.height/2})}for(let e of l.edges)h.push({...e,points:e.points.map(e=>({x:e.x+a.x,y:e.y+a.y})),labelPosition:e.labelPosition?{x:e.labelPosition.x+a.x,y:e.labelPosition.y+a.y}:void 0});let s=function e(t,r){for(let n of t){if(n.id===r)return n;let t=e(n.children,r);if(t)return t}}(o,r);s&&l.groups.length>0&&(s.children=l.groups.map(e=>(function e(t,r,n){return{...t,x:t.x+r,y:t.y+n,children:t.children.map(t=>e(t,r,n))}})(e,a.x,a.y)))}for(let e of h){if(a.has(e.source)&&a.has(e.target))continue;let r=!1;if(a.has(e.source)){let n=t.get(e.source);n&&e.points.length>0&&(e.points[0]={x:n.cx,y:n.cy},r=!0)}if(a.has(e.target)){let n=t.get(e.target);n&&e.points.length>0&&(e.points[e.points.length-1]={x:n.cx,y:n.cy},r=!0)}r&&(e.points=ew(e.points,s))}}var d=o,f=28;for(let e of d)!function e(t,r){for(let n of t.children)e(n,r);if(t.children.length>0){let e=t.y,r=t.y+t.height;for(let n of t.children)e=Math.min(e,n.y),r=Math.max(r,n.y+n.height);t.height=r-e,t.y=e}if(t.label){let e=r+8;t.y-=e,t.height+=e}}(e,f);let c=function e(t){let r=[];for(let n of t)r.push(n),r.push(...e(n.children));return r}(o),u=[...i.map(e=>e.y),...c.map(e=>e.y)],g=u.length>0?Math.min(...u):r,p=e.graph().width??800,m=e.graph().height??600;if(g<r){let e=r-g;for(let t of i)t.y+=e;for(let t of h){for(let r of t.points)r.y+=e;t.labelPosition&&(t.labelPosition.y+=e)}for(let t of c)t.y+=e;m+=e}let y=Math.max(...i.map(e=>e.y+e.height),...c.map(e=>e.y+e.height),...h.flatMap(e=>e.points.map(e=>e.y)));return y+r>m&&(m=y+r),{width:p,height:m,nodes:i,edges:h,groups:o}}(o,e,n.padding,i)}function e_(e){switch(e){case"LR":return"LR";case"RL":return"RL";case"BT":return"BT";default:return"TB"}}function eE(e,t,r){let n=eu(t,13,500)+32,i=33;if("diamond"===r){let e=Math.max(n,i)+24;n=e,i=e}if("circle"===r||"doublecircle"===r){let e=Math.ceil(Math.sqrt(n*n+i*i))+8;i=n="doublecircle"===r?e+12:e}return"hexagon"===r&&(n+=16),("trapezoid"===r||"trapezoid-alt"===r)&&(n+=16),"asymmetric"===r&&(n+=12),"cylinder"===r&&(i+=14),("state-start"===r||"state-end"===r)&&(n=28,i=28),{width:n=Math.max(n,60),height:i=Math.max(i,36)}}function ej(e,t,r,n){for(let i of(e.setNode(t.id,{label:t.label}),n&&e.setParent(t.id,n),t.nodeIds)){let n=r.nodes.get(i);if(n){let r=eE(i,n.label,n.shape);e.setNode(i,{label:n.label,width:r.width,height:r.height}),e.setParent(i,t.id)}}for(let n of t.children)ej(e,n,r,t.id)}function eC(e,t){let r=e.classAssignments.get(t),n=r?e.classDefs.get(r):void 0,i=e.nodeStyles.get(t);if(n||i)return{...n,...i}}function eO(e,t){for(let r of e.nodeIds)t.add(r);for(let r of e.children)eO(r,t)}function eL(e,t){let r=e.node(t.id),n=r?em(r.x,r.y,r.width,r.height):{x:0,y:0};return{id:t.id,label:t.label,x:n.x,y:n.y,width:r?.width??0,height:r?.height??0,children:t.children.map(t=>eL(e,t))}}function eS(e,t){for(let r of(t.add(e.id),e.children))eS(r,t)}function eN(e,t){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}function eA(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function eR(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}async function eD(e,r={}){if(0===e.classes.length)return{width:0,height:0,classes:[],relationships:[]};let n=new Map;for(let t of e.classes){let e=t.annotation?48:32,r=t.attributes.length>0?20*t.attributes.length+8:8,i=t.methods.length>0?20*t.methods.length+8:8,o=Math.max(120,eu(t.label,13,500)+16,eI(t.attributes)+16,eI(t.methods)+16),l=e+r+i;n.set(t.id,{width:o,height:l,headerHeight:e,attrHeight:r,methodHeight:i})}let i=new t.default.graphlib.Graph({directed:!0});for(let t of(i.setGraph({rankdir:"TB",acyclicer:"greedy",nodesep:40,ranksep:60,marginx:40,marginy:40}),i.setDefaultEdgeLabel(()=>({})),e.classes)){let e=n.get(t.id);i.setNode(t.id,{width:e.width,height:e.height})}for(let t=0;t<e.relationships.length;t++){let r=e.relationships[t],n={_index:t};r.label&&(n.label=r.label,n.width=eu(r.label,11,400)+8,n.height=17,n.labelpos="c"),i.setEdge(r.from,r.to,n)}try{t.default.layout(i)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error(`Dagre layout failed (class diagram): ${e}`)}let o=new Map;for(let t of e.classes)o.set(t.id,t);let l=e.classes.map(e=>{let t=i.node(e.id),r=n.get(e.id),o=em(t.x,t.y,t.width,t.height);return{id:e.id,label:e.label,annotation:e.annotation,attributes:e.attributes,methods:e.methods,x:o.x,y:o.y,width:t.width??r.width,height:t.height??r.height,headerHeight:r.headerHeight,attrHeight:r.attrHeight,methodHeight:r.methodHeight}}),a=i.edges().map(t=>{let r,n=i.edge(t),o=e.relationships[n._index],l=ew(n.points??[],!0),a=i.node(t.v),s=i.node(t.w),h=eb(l,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null,s?{cx:s.x,cy:s.y,hw:s.width/2,hh:s.height/2}:null);return o.label&&null!=n.x&&null!=n.y&&(r={x:n.x,y:n.y}),{from:o.from,to:o.to,type:o.type,markerAt:o.markerAt,label:o.label,fromCardinality:o.fromCardinality,toCardinality:o.toCardinality,points:h,labelPosition:r}});return{width:i.graph().width??600,height:i.graph().height??400,classes:l,relationships:a}}function eI(e){if(0===e.length)return 0;let t=0;for(let r of e){let e=eg(function(e){let t=e.visibility?`${e.visibility} `:"",r=e.type?`: ${e.type}`:"";return`${t}${e.name}${r}`}(r),11);e>t&&(t=e)}return t}function ez(e,t,r){let n=e.isAbstract?' font-style="italic"':"",i=e.isStatic?' text-decoration="underline"':"",o=[];return e.visibility&&o.push(`<tspan fill="var(--_text-faint)">${eX(e.visibility)} </tspan>`),o.push(`<tspan fill="var(--_text-sec)">${eX(e.name)}</tspan>`),e.type&&(o.push('<tspan fill="var(--_text-faint)">: </tspan>'),o.push(`<tspan fill="var(--_text-muted)">${eX(e.type)}</tspan>`)),`<text x="${t}" y="${r}" class="mono" dy="${ep}" font-size="11" font-weight="400"${n}${i}>${o.join("")}</text>`}function eY(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.abs(r)>Math.abs(n)?{x:r>0?14:-14,y:-10}:{x:-14,y:n>0?14:-14}}function eX(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}async function eW(e,r={}){if(0===e.entities.length)return{width:0,height:0,entities:[],relationships:[]};let n=new Map;for(let t of e.entities){let e=eu(t.label,13,500),r=0;for(let e of t.attributes){let t=eg(`${e.type}  ${e.name}${e.keys.length>0?"  "+e.keys.join(","):""}`,11);t>r&&(r=t)}let i=Math.max(140,e+24,r+24),o=32+22*Math.max(t.attributes.length,1);n.set(t.id,{width:i,height:o})}let i=new t.default.graphlib.Graph({directed:!0});for(let t of(i.setGraph({rankdir:"LR",acyclicer:"greedy",nodesep:50,ranksep:70,marginx:40,marginy:40}),i.setDefaultEdgeLabel(()=>({})),e.entities)){let e=n.get(t.id);i.setNode(t.id,{width:e.width,height:e.height})}for(let t=0;t<e.relationships.length;t++){let r=e.relationships[t];i.setEdge(r.entity1,r.entity2,{_index:t,label:r.label,width:eu(r.label,11,400)+8,height:17,labelpos:"c"})}try{t.default.layout(i)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error(`Dagre layout failed (ER diagram): ${e}`)}let o=new Map;for(let t of e.entities)o.set(t.id,t);let l=e.entities.map(e=>{let t=i.node(e.id),r=em(t.x,t.y,t.width,t.height);return{id:e.id,label:e.label,attributes:e.attributes,x:r.x,y:r.y,width:t.width??n.get(e.id).width,height:t.height??n.get(e.id).height,headerHeight:32,rowHeight:22}}),a=i.edges().map(t=>{let r=i.edge(t),n=e.relationships[r._index],o=ew(r.points??[],!1),l=i.node(t.v),a=i.node(t.w),s=eb(o,l?{cx:l.x,cy:l.y,hw:l.width/2,hh:l.height/2}:null,a?{cx:a.x,cy:a.y,hw:a.width/2,hh:a.height/2}:null);return{entity1:n.entity1,entity2:n.entity2,cardinality1:n.cardinality1,cardinality2:n.cardinality2,label:n.label,identifying:n.identifying,points:s}});return{width:i.graph().width??600,height:i.graph().height??400,entities:l,relationships:a}}function eT(e,t,r){let n=[],i=1,o=e.x-t.x,l=e.y-t.y,a=Math.sqrt(o*o+l*l);if(0===a)return"";let s=o/a,h=l/a,d=-h,f=e.x-4*s,c=e.y-4*h,u=e.x-16*s,g=e.y-16*h,p="many"===r||"zero-many"===r;if("one"===r||"zero-one"===r){n.push(`<line x1="${f+6*d}" y1="${c+6*s}" x2="${f-6*d}" y2="${c-6*s}" stroke="var(--_line)" stroke-width="${i}" />`);let e=f-4*s,t=c-4*h;n.push(`<line x1="${e+6*d}" y1="${t+6*s}" x2="${e-6*d}" y2="${t-6*s}" stroke="var(--_line)" stroke-width="${i}" />`)}if(p&&(n.push(`<line x1="${f+7*d}" y1="${c+7*s}" x2="${u}" y2="${g}" stroke="var(--_line)" stroke-width="${i}" />`),n.push(`<line x1="${f}" y1="${c}" x2="${u}" y2="${g}" stroke="var(--_line)" stroke-width="${i}" />`),n.push(`<line x1="${f-7*d}" y1="${c-7*s}" x2="${u}" y2="${g}" stroke="var(--_line)" stroke-width="${i}" />`)),"zero-one"===r||"zero-many"===r){let t=p?20:12,r=e.x-s*t,o=e.y-h*t;n.push(`<circle cx="${r}" cy="${o}" r="4" fill="var(--bg)" stroke="var(--_line)" stroke-width="${i}" />`)}return n.join("\n")}function eB(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}async function eP(e,t={}){let n,i={bg:t.bg??r.bg,fg:t.fg??r.fg,line:t.line,accent:t.accent,muted:t.muted,surface:t.surface,border:t.border},s=t.font??"Inter",h=t.transparent??!1,d=(n=e.trim().split("\n")[0]?.trim().toLowerCase()??"",/^sequencediagram\s*$/.test(n)?"sequence":/^classdiagram\s*$/.test(n)?"class":/^erdiagram\s*$/.test(n)?"er":"flowchart"),f=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0&&!e.startsWith("%%"));switch(d){case"sequence":return function(e,t,r="Inter",n=!1){var i,a,s;let h=[];for(let i of(h.push(l(e.width,e.height,t,n)),h.push(o(r,!1)),h.push("<defs>"),h.push(`  <marker id="seq-arrow" markerWidth="8" markerHeight="4.8" refX="8" refY="${2.4}" orient="auto-start-reverse">
    <polygon points="0 0, 8 ${2.4}, 0 4.8" fill="var(--_arrow)" />
  </marker>
  <marker id="seq-arrow-open" markerWidth="8" markerHeight="4.8" refX="8" refY="${2.4}" orient="auto-start-reverse">
    <polyline points="0 0, 8 ${2.4}, 0 4.8" fill="none" stroke="var(--_arrow)" stroke-width="1" />
  </marker>`),h.push("</defs>"),e.blocks))h.push(function(e){let t=[];t.push(`<rect x="${e.x}" y="${e.y}" width="${e.width}" height="${e.height}" rx="0" ry="0" fill="none" stroke="var(--_node-stroke)" stroke-width="1" />`);let r=`${e.type}${e.label?` [${e.label}]`:""}`,n=eu(r,11,600)+16;for(let i of(t.push(`<rect x="${e.x}" y="${e.y}" width="${n}" height="18" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="1" />`),t.push(`<text x="${e.x+6}" y="${e.y+9}" dy="${ep}" font-size="11" font-weight="600" fill="var(--_text-sec)">${eR(r)}</text>`),e.dividers))t.push(`<line x1="${e.x}" y1="${i.y}" x2="${e.x+e.width}" y2="${i.y}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`),i.label&&t.push(`<text x="${e.x+8}" y="${i.y+14}" font-size="11" font-weight="400" fill="var(--_text-muted)">[${eR(i.label)}]</text>`);return t.join("\n")}(i));for(let t of e.lifelines){h.push((i=t,`<line x1="${i.x}" y1="${i.topY}" x2="${i.x}" y2="${i.bottomY}" stroke="var(--_line)" stroke-width="0.75" stroke-dasharray="6 4" />`))}for(let t of e.activations){h.push((a=t,`<rect x="${a.x}" y="${a.topY}" width="${a.width}" height="${a.bottomY-a.topY}" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="0.75" />`))}for(let t of e.messages)h.push(function(e){let t=[],r="dashed"===e.lineStyle?' stroke-dasharray="6 4"':"",n="filled"===e.arrowHead?"seq-arrow":"seq-arrow-open";if(e.isSelf)t.push(`<polyline points="${e.x1},${e.y} ${e.x1+30},${e.y} ${e.x1+30},${e.y+20} ${e.x2},${e.y+20}" fill="none" stroke="var(--_line)" stroke-width="0.75"${r} marker-end="url(#${n})" />`),t.push(`<text x="${e.x1+30+6}" y="${e.y+10}" dy="${ep}" font-size="11" font-weight="400" fill="var(--_text-muted)">${eR(e.label)}</text>`);else{t.push(`<line x1="${e.x1}" y1="${e.y}" x2="${e.x2}" y2="${e.y}" stroke="var(--_line)" stroke-width="0.75"${r} marker-end="url(#${n})" />`);let i=(e.x1+e.x2)/2;t.push(`<text x="${i}" y="${e.y-6}" text-anchor="middle" font-size="11" font-weight="400" fill="var(--_text-muted)">${eR(e.label)}</text>`)}return t.join("\n")}(t));for(let t of e.notes){h.push((s=t,`<rect x="${s.x}" y="${s.y}" width="${s.width}" height="${s.height}" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="0.75" />
<polygon points="${s.x+s.width-6},${s.y} ${s.x+s.width},${s.y+6} ${s.x+s.width-6},${s.y+6}" fill="var(--_inner-stroke)" />
<text x="${s.x+s.width/2}" y="${s.y+s.height/2}" text-anchor="middle" dy="${ep}" font-size="11" font-weight="400" fill="var(--_text-muted)">${eR(s.text)}</text>`))}for(let t of e.actors)h.push(function(e){let{x:t,y:r,width:n,height:i,label:o,type:l}=e;if("actor"===l){let e=i/24*.9,n=1/e,l="var(--_line)";return`<g transform="translate(${t-12*e},${r+(i-24*e)/2}) scale(${e})">
  <path d="M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" fill="none" stroke="${l}" stroke-width="${n}" />
  <path d="M15 10C15 11.6569 13.6569 13 12 13C10.3431 13 9 11.6569 9 10C9 8.34315 10.3431 7 12 7C13.6569 7 15 8.34315 15 10Z" fill="none" stroke="${l}" stroke-width="${n}" />
  <path d="M5.62842 18.3563C7.08963 17.0398 9.39997 16 12 16C14.6 16 16.9104 17.0398 18.3716 18.3563" fill="none" stroke="${l}" stroke-width="${n}" />
</g>
<text x="${t}" y="${r+i+14}" text-anchor="middle" font-size="13" font-weight="500" fill="var(--_text)">${eR(o)}</text>`}return`<rect x="${t-n/2}" y="${r}" width="${n}" height="${i}" rx="4" ry="4" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1" />
<text x="${t}" y="${r+i/2}" text-anchor="middle" dy="${ep}" font-size="13" font-weight="500" fill="var(--_text)">${eR(o)}</text>`}(t));return h.push("</svg>"),h.join("\n")}(function(e,t={}){if(0===e.actors.length)return{width:0,height:0,actors:[],lifelines:[],messages:[],activations:[],blocks:[],notes:[]};let r=e.actors.map(e=>Math.max(eu(e.label,13,500)+32,80)),n=[],i=30+r[0]/2;for(let t=0;t<e.actors.length;t++)t>0&&(i+=Math.max(140,(r[t-1]+r[t])/2+40)),n.push(i);let o=new Map;for(let t=0;t<e.actors.length;t++)o.set(e.actors[t].id,t);let l=e.actors.map((e,t)=>({id:e.id,label:e.label,type:e.type,x:n[t],y:30,width:r[t],height:40})),a=90,s=[],h=new Map;for(let t of e.blocks){let e=h.get(t.startIndex)??0;for(let r of(h.set(t.startIndex,Math.max(e,28)),t.dividers)){let e=h.get(r.index)??0;h.set(r.index,Math.max(e,24))}}let d=new Map,f=[];for(let t=0;t<e.messages.length;t++){let r=e.messages[t],i=o.get(r.from)??0,l=o.get(r.to)??0,c=r.from===r.to,u=h.get(t)??0;u>0&&(a+=u);let g=n[i],p=n[l];if(s.push({from:r.from,to:r.to,label:r.label,lineStyle:r.lineStyle,arrowHead:r.arrowHead,x1:g,x2:p,y:a,isSelf:c}),r.activate&&(d.has(r.to)||d.set(r.to,[]),d.get(r.to).push(a)),r.deactivate){let e=d.get(r.from);if(e&&e.length>0){let t=e.pop(),i=o.get(r.from)??0;f.push({actorId:r.from,x:n[i]-5,topY:t,bottomY:a,width:10})}}a+=c?70:40}for(let[e,t]of d)for(let r of t){let t=o.get(e)??0;f.push({actorId:e,x:n[t]-5,topY:r,bottomY:a-20,width:10})}let c=e.blocks.map(t=>{let i=s[t.startIndex],l=s[t.endIndex],h=(i?.y??a)-40,d=(l?.y??a)+8+12,f=new Set;for(let r=t.startIndex;r<=t.endIndex;r++){let t=e.messages[r];t&&(f.add(o.get(t.from)??0),f.add(o.get(t.to)??0))}if(0===f.size)for(let t=0;t<e.actors.length;t++)f.add(t);let c=Math.min(...f),u=Math.max(...f),g=n[c]-r[c]/2-10,p=n[u]+r[u]/2+10,m=t.dividers.map(e=>{let t=s[e.index],r=t?.y??a,n=28;if(e.label&&t?.label){let r=eu(`[${e.label}]`,11,400),i=g+8,o=eu(t.label,11,400),l=t.isSelf?t.x1+36:(t.x1+t.x2)/2-o/2;i+r>l&&i<l+o&&(n=36)}return{y:r-n,label:e.label}});return{type:t.type,label:t.label,x:g,y:h,width:p-g,height:d-h,dividers:m}}),u=e.notes.map(e=>{let t,i=Math.max(120,eu(e.text,11,400)+16),l=s[e.afterIndex],a=(l?.y??70)+4,h=o.get(e.actorIds[0]??"")??0;if("left"===e.position)t=n[h]-r[h]/2-i-10;else if("right"===e.position)t=n[h]+r[h]/2+10;else if(e.actorIds.length>1){let r=o.get(e.actorIds[e.actorIds.length-1]??"")??h;t=(n[h]+n[r])/2-i/2}else t=n[h]-i/2;return{text:e.text,x:t,y:a,width:i,height:27}}),g=a+30,p=30,m=0;for(let e of l)p=Math.min(p,e.x-e.width/2),m=Math.max(m,e.x+e.width/2);for(let e of c)p=Math.min(p,e.x),m=Math.max(m,e.x+e.width);for(let e of u)p=Math.min(p,e.x),m=Math.max(m,e.x+e.width);let y=p<30?30-p:0;if(y>0){for(let e of l)e.x+=y;for(let e of s)e.x1+=y,e.x2+=y;for(let e of f)e.x+=y;for(let e of c)e.x+=y;for(let e of u)e.x+=y;for(let e=0;e<n.length;e++)n[e]+=y}let x=e.actors.map((e,t)=>({actorId:e.id,x:n[t],topY:70,bottomY:g-30}));return{width:Math.max(m+y+30,200),height:Math.max(g,100),actors:l,lifelines:x,messages:s,activations:f,blocks:c,notes:u}}(ee(f),t),i,s,h);case"class":{let e=er(f);return function(e,t,r="Inter",n=!1){let i=[];for(let a of(i.push(l(e.width,e.height,t,n)),i.push(o(r,!0)),i.push("<defs>"),i.push(`  <marker id="cls-inherit" markerWidth="12" markerHeight="10" refX="12" refY="5" orient="auto-start-reverse">
    <polygon points="0 0, 12 5, 0 10" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-composition" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--_arrow)" stroke="var(--_arrow)" stroke-width="1" />
  </marker>
  <marker id="cls-aggregation" markerWidth="12" markerHeight="10" refX="0" refY="5" orient="auto-start-reverse">
    <polygon points="6 0, 12 5, 6 10, 0 5" fill="var(--bg)" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>
  <marker id="cls-arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto-start-reverse">
    <polyline points="0 0, 8 3, 0 6" fill="none" stroke="var(--_arrow)" stroke-width="1.5" />
  </marker>`),i.push("</defs>"),e.relationships))i.push(function(e){if(e.points.length<2)return"";let t=e.points.map(e=>`${e.x},${e.y}`).join(" "),r="dependency"===e.type||"realization"===e.type,n=function(e,t){let r=function(e){switch(e){case"inheritance":case"realization":return"cls-inherit";case"composition":return"cls-composition";case"aggregation":return"cls-aggregation";case"association":case"dependency":return"cls-arrow";default:return null}}(e);return r?"from"===t?` marker-start="url(#${r})"`:` marker-end="url(#${r})"`:""}(e.type,e.markerAt);return`<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="0.75"${r?' stroke-dasharray="6 4"':""}${n} />`}(a));for(let t of e.classes)i.push(function(e){let{x:t,y:r,width:n,height:i,headerHeight:o,attrHeight:l,methodHeight:a}=e,s=[];s.push(`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1" />`),s.push(`<rect x="${t}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="1" />`);let h=r+o/2;e.annotation&&(s.push(`<text x="${t+n/2}" y="${r+12}" text-anchor="middle" dy="${ep}" font-size="10" font-weight="500" font-style="italic" fill="var(--_text-muted)">&lt;&lt;${eX(e.annotation)}&gt;&gt;</text>`),h=r+o/2+6),s.push(`<text x="${t+n/2}" y="${h}" text-anchor="middle" dy="${ep}" font-size="13" font-weight="700" fill="var(--_text)">${eX(e.label)}</text>`);let d=r+o;s.push(`<line x1="${t}" y1="${d}" x2="${t+n}" y2="${d}" stroke="var(--_node-stroke)" stroke-width="0.75" />`);for(let r=0;r<e.attributes.length;r++){let n=e.attributes[r],i=d+4+20*r+10;s.push(ez(n,t+8,i))}let f=d+l;s.push(`<line x1="${t}" y1="${f}" x2="${t+n}" y2="${f}" stroke="var(--_node-stroke)" stroke-width="0.75" />`);for(let r=0;r<e.methods.length;r++){let n=e.methods[r],i=f+4+20*r+10;s.push(ez(n,t+8,i))}return s.join("\n")}(t));for(let t of e.relationships)i.push(function(e){if(!e.label&&!e.fromCardinality&&!e.toCardinality||e.points.length<2)return"";let t=[];if(e.label){let r=e.labelPosition??function(e){if(0===e.length)return{x:0,y:0};let t=Math.floor(e.length/2);return e[t]}(e.points);t.push(`<text x="${r.x}" y="${r.y-8}" text-anchor="middle" font-size="11" font-weight="400" fill="var(--_text-muted)">${eX(e.label)}</text>`)}if(e.fromCardinality){let r=e.points[0],n=eY(r,e.points[1]);t.push(`<text x="${r.x+n.x}" y="${r.y+n.y}" text-anchor="middle" font-size="11" font-weight="400" fill="var(--_text-muted)">${eX(e.fromCardinality)}</text>`)}if(e.toCardinality){let r=e.points[e.points.length-1],n=eY(r,e.points[e.points.length-2]);t.push(`<text x="${r.x+n.x}" y="${r.y+n.y}" text-anchor="middle" font-size="11" font-weight="400" fill="var(--_text-muted)">${eX(e.toCardinality)}</text>`)}return t.join("\n")}(t));return i.push("</svg>"),i.join("\n")}(await eD(e,t),i,s,h)}case"er":{let e=ea(f);return function(e,t,r="Inter",n=!1){let i=[];for(let a of(i.push(l(e.width,e.height,t,n)),i.push(o(r,!0)),i.push("<defs>"),i.push("</defs>"),e.relationships))i.push(function(e){if(e.points.length<2)return"";let t=e.points.map(e=>`${e.x},${e.y}`).join(" "),r=e.identifying?"":' stroke-dasharray="6 4"';return`<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="0.75"${r} />`}(a));for(let t of e.entities)i.push(function(e){let{x:t,y:r,width:n,height:i,headerHeight:o,rowHeight:l,label:a,attributes:s}=e,h=[];h.push(`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="0" ry="0" fill="var(--_node-fill)" stroke="var(--_node-stroke)" stroke-width="1" />`),h.push(`<rect x="${t}" y="${r}" width="${n}" height="${o}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="1" />`),h.push(`<text x="${t+n/2}" y="${r+o/2}" text-anchor="middle" dy="${ep}" font-size="13" font-weight="700" fill="var(--_text)">${eB(a)}</text>`);let d=r+o;h.push(`<line x1="${t}" y1="${d}" x2="${t+n}" y2="${d}" stroke="var(--_node-stroke)" stroke-width="0.75" />`);for(let e=0;e<s.length;e++){let r=s[e],i=d+e*l+l/2;h.push(function(e,t,r,n){let i=[],o=0;e.keys.length>0&&(o=eu(e.keys.join(","),9,600)+8,i.push(`<rect x="${t+6}" y="${r-7}" width="${o}" height="14" rx="2" ry="2" fill="var(--_key-badge)" />`),i.push(`<text x="${t+6+o/2}" y="${r}" text-anchor="middle" dy="${ep}" font-size="9" font-weight="600" fill="var(--_text-sec)">${e.keys.join(",")}</text>`));let l=t+8+(o>0?o+6:0);return i.push(`<text x="${l}" y="${r}" class="mono" dy="${ep}" font-size="11" font-weight="400"><tspan fill="var(--_text-muted)">${eB(e.type)}</tspan></text>`),i.push(`<text x="${t+n-8}" y="${r}" class="mono" text-anchor="end" dy="${ep}" font-size="11" font-weight="400"><tspan fill="var(--_text-sec)">${eB(e.name)}</tspan></text>`),i.join("\n")}(r,t,i,n))}return 0===s.length&&h.push(`<text x="${t+n/2}" y="${d+l/2}" text-anchor="middle" dy="${ep}" font-size="11" fill="var(--_text-faint)" font-style="italic">(no attributes)</text>`),h.join("\n")}(t));for(let t of e.relationships)i.push(function(e){if(e.points.length<2)return"";let t=[];return t.push(eT(e.points[0],e.points[1],e.cardinality1)),t.push(eT(e.points[e.points.length-1],e.points[e.points.length-2],e.cardinality2)),t.join("\n")}(t));for(let t of e.relationships)i.push(function(e){if(!e.label||e.points.length<2)return"";let t=function(e){if(0===e.length)return{x:0,y:0};if(1===e.length)return e[0];let t=0;for(let r=1;r<e.length;r++){let n=e[r].x-e[r-1].x,i=e[r].y-e[r-1].y;t+=Math.sqrt(n*n+i*i)}if(0===t)return e[0];let r=t/2,n=0;for(let t=1;t<e.length;t++){let i=e[t].x-e[t-1].x,o=e[t].y-e[t-1].y,l=Math.sqrt(i*i+o*o);if(n+l>=r){let a=l>0?(r-n)/l:0;return{x:e[t-1].x+i*a,y:e[t-1].y+o*a}}n+=l}return e[e.length-1]}(e.points),r=eu(e.label,11,400)+8,n=17;return`<rect x="${t.x-r/2}" y="${t.y-n/2}" width="${r}" height="${n}" rx="2" ry="2" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${t.x}" y="${t.y}" text-anchor="middle" dy="${ep}" font-size="11" font-weight="400" fill="var(--_text-muted)">${eB(e.label)}</text>`}(t));return i.push("</svg>"),i.join("\n")}(await eW(e,t),i,s,h)}default:{let r=a(e);return function(e,t,r="Inter",n=!1){let i=[];for(let a of(i.push(l(e.width,e.height,t,n)),i.push(o(r,!1)),i.push("<defs>"),i.push(`  <marker id="arrowhead" markerWidth="8" markerHeight="4.8" refX="8" refY="${2.4}" orient="auto">
    <polygon points="0 0, 8 ${2.4}, 0 4.8" fill="var(--_arrow)" />
  </marker>
  <marker id="arrowhead-start" markerWidth="8" markerHeight="4.8" refX="0" refY="${2.4}" orient="auto-start-reverse">
    <polygon points="8 0, 0 ${2.4}, 8 4.8" fill="var(--_arrow)" />
  </marker>`),i.push("</defs>"),e.groups))i.push(function e(t,r){let n=28,i=[];for(let r of(i.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${t.height}" rx="0" ry="0" fill="var(--_group-fill)" stroke="var(--_node-stroke)" stroke-width="1" />`),i.push(`<rect x="${t.x}" y="${t.y}" width="${t.width}" height="${n}" rx="0" ry="0" fill="var(--_group-hdr)" stroke="var(--_node-stroke)" stroke-width="1" />`),i.push(`<text x="${t.x+12}" y="${t.y+n/2}" dy="${ep}" font-size="12" font-weight="600" fill="var(--_text-sec)">${eA(t.label)}</text>`),t.children))i.push(e(r));return i.join("\n")}(a));for(let t of e.edges)i.push(function(e){if(e.points.length<2)return"";let t=e.points.map(e=>`${e.x},${e.y}`).join(" "),r="dotted"===e.style?' stroke-dasharray="4 4"':"",n="thick"===e.style?1.5:.75,i="";return e.hasArrowEnd&&(i+=' marker-end="url(#arrowhead)"'),e.hasArrowStart&&(i+=' marker-start="url(#arrowhead-start)"'),`<polyline points="${t}" fill="none" stroke="var(--_line)" stroke-width="${n}"${r}${i} />`}(t));for(let t of e.edges)t.label&&i.push(function(e,t){let r=e.labelPosition??function(e){if(0===e.length)return{x:0,y:0};if(1===e.length)return e[0];let t=0;for(let r=1;r<e.length;r++)t+=eN(e[r-1],e[r]);let r=t/2;for(let t=1;t<e.length;t++){let n=eN(e[t-1],e[t]);if(r<=n){let i=r/n;return{x:e[t-1].x+i*(e[t].x-e[t-1].x),y:e[t-1].y+i*(e[t].y-e[t-1].y)}}r-=n}return e[e.length-1]}(e.points),n=e.label,i=eu(n,11,400)+16,o=27;return`<rect x="${r.x-i/2}" y="${r.y-o/2}" width="${i}" height="${o}" rx="4" ry="4" fill="var(--bg)" stroke="var(--_inner-stroke)" stroke-width="0.5" />
<text x="${r.x}" y="${r.y}" text-anchor="middle" dy="${ep}" font-size="11" font-weight="400" fill="var(--_text-muted)">${eA(n)}</text>`}(t));for(let t of e.nodes)i.push(function(e){var t,r,n,i,o,l,a,s,h,d,f,c,u,g,p,m,y,x,w,b,v;let{x:$,y:k,width:M,height:_,shape:E,inlineStyle:j}=e,C=eA(j?.fill??"var(--_node-fill)"),O=eA(j?.stroke??"var(--_node-stroke)"),L=eA(j?.["stroke-width"]??String(.75));switch(E){case"diamond":return function(e,t,r,n,i,o,l){let a=e+r/2,s=t+n/2,h=r/2,d=n/2,f=`${a},${s-d} ${a+h},${s} ${a},${s+d} ${a-h},${s}`;return`<polygon points="${f}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"rounded":return t=$,r=k,n=M,i=_,o=C,l=O,a=L,`<rect x="${t}" y="${r}" width="${n}" height="${i}" rx="6" ry="6" fill="${o}" stroke="${l}" stroke-width="${a}" />`;case"stadium":return function(e,t,r,n,i,o,l){let a=n/2;return`<rect x="${e}" y="${t}" width="${r}" height="${n}" rx="${a}" ry="${a}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"circle":return function(e,t,r,n,i,o,l){let a=Math.min(r,n)/2;return`<circle cx="${e+r/2}" cy="${t+n/2}" r="${a}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"subroutine":return s=$,h=k,d=M,f=_,c=C,u=O,g=L,`<rect x="${s}" y="${h}" width="${d}" height="${f}" rx="0" ry="0" fill="${c}" stroke="${u}" stroke-width="${g}" />
<line x1="${s+8}" y1="${h}" x2="${s+8}" y2="${h+f}" stroke="${u}" stroke-width="${g}" />
<line x1="${s+d-8}" y1="${h}" x2="${s+d-8}" y2="${h+f}" stroke="${u}" stroke-width="${g}" />`;case"doublecircle":return function(e,t,r,n,i,o,l){let a=e+r/2,s=t+n/2,h=Math.min(r,n)/2;return`<circle cx="${a}" cy="${s}" r="${h}" fill="${i}" stroke="${o}" stroke-width="${l}" />
<circle cx="${a}" cy="${s}" r="${h-5}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"hexagon":return function(e,t,r,n,i,o,l){let a=n/4,s=`${e+a},${t} ${e+r-a},${t} ${e+r},${t+n/2} ${e+r-a},${t+n} ${e+a},${t+n} ${e},${t+n/2}`;return`<polygon points="${s}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"cylinder":return function(e,t,r,n,i,o,l){let a=e+r/2,s=t+7,h=n-14;return`<rect x="${e}" y="${s}" width="${r}" height="${h}" fill="${i}" stroke="none" />
<line x1="${e}" y1="${s}" x2="${e}" y2="${s+h}" stroke="${o}" stroke-width="${l}" />
<line x1="${e+r}" y1="${s}" x2="${e+r}" y2="${s+h}" stroke="${o}" stroke-width="${l}" />
<ellipse cx="${a}" cy="${t+n-7}" rx="${r/2}" ry="7" fill="${i}" stroke="${o}" stroke-width="${l}" />
<ellipse cx="${a}" cy="${s}" rx="${r/2}" ry="7" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"asymmetric":return function(e,t,r,n,i,o,l){let a=`${e+12},${t} ${e+r},${t} ${e+r},${t+n} ${e+12},${t+n} ${e},${t+n/2}`;return`<polygon points="${a}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"trapezoid":return function(e,t,r,n,i,o,l){let a=.15*r,s=`${e+a},${t} ${e+r-a},${t} ${e+r},${t+n} ${e},${t+n}`;return`<polygon points="${s}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"trapezoid-alt":return function(e,t,r,n,i,o,l){let a=.15*r,s=`${e},${t} ${e+r},${t} ${e+r-a},${t+n} ${e+a},${t+n}`;return`<polygon points="${s}" fill="${i}" stroke="${o}" stroke-width="${l}" />`}($,k,M,_,C,O,L);case"state-start":return function(e,t,r,n){let i=Math.min(r,n)/2-2;return`<circle cx="${e+r/2}" cy="${t+n/2}" r="${i}" fill="var(--_text)" stroke="none" />`}($,k,M,_);case"state-end":return function(e,t,r,n){let i=e+r/2,o=t+n/2,l=Math.min(r,n)/2-2;return`<circle cx="${i}" cy="${o}" r="${l}" fill="none" stroke="var(--_text)" stroke-width="${1.5}" />
<circle cx="${i}" cy="${o}" r="${l-4}" fill="var(--_text)" stroke="none" />`}($,k,M,_);default:return p=$,m=k,y=M,x=_,w=C,b=O,v=L,`<rect x="${p}" y="${m}" width="${y}" height="${x}" rx="0" ry="0" fill="${w}" stroke="${b}" stroke-width="${v}" />`}}(t));for(let t of e.nodes)i.push(function(e,t){if(("state-start"===e.shape||"state-end"===e.shape)&&!e.label)return"";let r=e.x+e.width/2,n=e.y+e.height/2,i=eA(e.inlineStyle?.color??"var(--_text)");return`<text x="${r}" y="${n}" text-anchor="middle" dy="${ep}" font-size="13" font-weight="500" fill="${i}">${eA(e.label)}</text>`}(t));return i.push("</svg>"),i.join("\n")}(await eM(r,t),i,s,h)}}}e.s(["DEFAULTS",()=>r,"THEMES",()=>n,"fromShikiTheme",()=>i,"parseMermaid",()=>a,"renderMermaid",()=>eP,"renderMermaidAscii",()=>ec])}]);